{"componentChunkName":"component---src-templates-post-tsx","path":"/2018-03-1-Founds/","result":{"data":{"markdownRemark":{"html":"<h2 id=\"handle_irq---oobs\" style=\"position:relative;\"><a href=\"#handle_irq---oobs\" aria-label=\"handle_irq   oobs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>handle_irq - OOBs</h2>\n<h3 id=\"call-trace-dump\" style=\"position:relative;\"><a href=\"#call-trace-dump\" aria-label=\"call trace dump permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Call Trace (Dump)</h3>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">BUG<span class=\"token operator\">:</span> KASAN<span class=\"token operator\">:</span> alloca<span class=\"token operator\">-</span>out<span class=\"token operator\">-</span>of<span class=\"token operator\">-</span>bounds in handle_irq<span class=\"token operator\">+</span><span class=\"token number\">0x218</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f3</span>\nRead of size <span class=\"token number\">8</span> at addr ffff88007b086240 by task syzkaller734473<span class=\"token operator\">/</span><span class=\"token number\">2831</span>\n\nCPU<span class=\"token operator\">:</span> <span class=\"token number\">0</span> PID<span class=\"token operator\">:</span> <span class=\"token number\">2831</span> Comm<span class=\"token operator\">:</span> syzkaller734473 Not tainted <span class=\"token number\">4.16</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc3<span class=\"token operator\">+</span> #<span class=\"token number\">2</span>\nHardware name<span class=\"token operator\">:</span> QEMU Standard <span class=\"token function\">PC</span> <span class=\"token punctuation\">(</span>i440FX <span class=\"token operator\">+</span> PIIX<span class=\"token punctuation\">,</span> <span class=\"token number\">1996</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BIOS <span class=\"token number\">1.10</span><span class=\"token number\">.2</span><span class=\"token operator\">-</span><span class=\"token number\">1u</span>buntu1 <span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">01</span><span class=\"token operator\">/</span><span class=\"token number\">2014</span>\nCall Trace<span class=\"token operator\">:</span>\n <span class=\"token operator\">&lt;</span>IRQ<span class=\"token operator\">></span>\n dump_stack<span class=\"token operator\">+</span><span class=\"token number\">0x127</span><span class=\"token operator\">/</span><span class=\"token number\">0x213</span>\n print_address_description<span class=\"token operator\">+</span><span class=\"token number\">0x60</span><span class=\"token operator\">/</span><span class=\"token number\">0x22b</span>\n kasan_report<span class=\"token punctuation\">.</span>cold<span class=\"token punctuation\">.</span><span class=\"token number\">6</span><span class=\"token operator\">+</span><span class=\"token number\">0xac</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f4</span>\n <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>IRQ<span class=\"token operator\">></span>\n\nThe buggy address belongs to the page<span class=\"token operator\">:</span>\npage<span class=\"token operator\">:</span>ffffea0001ec2180 count<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapcount<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapping<span class=\"token operator\">:</span><span class=\"token number\">0000000000000000</span> index<span class=\"token operator\">:</span><span class=\"token number\">0xffff88007b087dd0</span>\nflags<span class=\"token operator\">:</span> <span class=\"token number\">0x500000000000000</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nraw<span class=\"token operator\">:</span> <span class=\"token number\">0500000000000000</span> <span class=\"token number\">0000000000000000</span> ffff88007b087dd0 <span class=\"token number\">00000000ffff</span>ffff\nraw<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> dead000000000200 <span class=\"token number\">0000000000000000</span> <span class=\"token number\">0000000000000000</span>\npage dumped because<span class=\"token operator\">:</span> kasan<span class=\"token operator\">:</span> bad access detected\n\nMemory state around the buggy address<span class=\"token operator\">:</span>\n ffff88007b086100<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n ffff88007b086180<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token operator\">></span>ffff88007b086200<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> cb cb cb cb <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n                                           <span class=\"token operator\">^</span>\n ffff88007b086280<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n ffff88007b086300<span class=\"token operator\">:</span> <span class=\"token number\">00</span> f1 f1 f1 f1 <span class=\"token number\">02</span> f2 f2 f2 f2 f2 f2 f2 <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\nKernel panic <span class=\"token operator\">-</span> not syncing<span class=\"token operator\">:</span> panic_on_warn set <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\nCPU<span class=\"token operator\">:</span> <span class=\"token number\">0</span> PID<span class=\"token operator\">:</span> <span class=\"token number\">2831</span> Comm<span class=\"token operator\">:</span> syzkaller734473 Tainted<span class=\"token operator\">:</span> G    B            <span class=\"token number\">4.16</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc3<span class=\"token operator\">+</span> #<span class=\"token number\">2</span>\nHardware name<span class=\"token operator\">:</span> QEMU Standard <span class=\"token function\">PC</span> <span class=\"token punctuation\">(</span>i440FX <span class=\"token operator\">+</span> PIIX<span class=\"token punctuation\">,</span> <span class=\"token number\">1996</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BIOS <span class=\"token number\">1.10</span><span class=\"token number\">.2</span><span class=\"token operator\">-</span><span class=\"token number\">1u</span>buntu1 <span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">01</span><span class=\"token operator\">/</span><span class=\"token number\">2014</span>\nCall Trace<span class=\"token operator\">:</span>\n <span class=\"token operator\">&lt;</span>IRQ<span class=\"token operator\">></span>\n dump_stack<span class=\"token operator\">+</span><span class=\"token number\">0x127</span><span class=\"token operator\">/</span><span class=\"token number\">0x213</span>\n panic<span class=\"token operator\">+</span><span class=\"token number\">0x1f8</span><span class=\"token operator\">/</span><span class=\"token number\">0x46f</span>\n kasan_end_report<span class=\"token operator\">+</span><span class=\"token number\">0x43</span><span class=\"token operator\">/</span><span class=\"token number\">0x49</span>\n kasan_report<span class=\"token punctuation\">.</span>cold<span class=\"token punctuation\">.</span><span class=\"token number\">6</span><span class=\"token operator\">+</span><span class=\"token number\">0xc8</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f4</span>\n <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>IRQ<span class=\"token operator\">></span>\nDumping ftrace buffer<span class=\"token operator\">:</span>\n   <span class=\"token punctuation\">(</span>ftrace buffer empty<span class=\"token punctuation\">)</span>\nKernel Offset<span class=\"token operator\">:</span> <span class=\"token number\">0x26800000</span> from <span class=\"token number\">0xffffffff81000000</span> <span class=\"token punctuation\">(</span>relocation range<span class=\"token operator\">:</span> <span class=\"token number\">0xffffffff80000000</span><span class=\"token operator\">-</span><span class=\"token number\">0xffffffffbfffffff</span><span class=\"token punctuation\">)</span>\nRebooting in <span class=\"token number\">86400</span> seconds<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h3 id=\"poc\" style=\"position:relative;\"><a href=\"#poc\" aria-label=\"poc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PoC</h3>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_GNU_SOURCE</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;endian.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/syscall.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;signal.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/time.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/wait.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;time.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/prctl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;dirent.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/mount.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sched.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;signal.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdbool.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/prctl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/resource.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/time.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/wait.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/net.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;netinet/in.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/socket.h></span></span>\n\n<span class=\"token keyword\">__attribute__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>noreturn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> status<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">volatile</span> <span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_exit_group<span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdint.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/stat.h></span></span>\n\n<span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> kFailStatus <span class=\"token operator\">=</span> <span class=\"token number\">67</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> kRetryStatus <span class=\"token operator\">=</span> <span class=\"token number\">69</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> msg<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> e <span class=\"token operator\">=</span> errno<span class=\"token punctuation\">;</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vfprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" (errno %d)\\n\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">==</span> ENOMEM <span class=\"token operator\">||</span> e <span class=\"token operator\">==</span> EAGAIN<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> kRetryStatus <span class=\"token operator\">:</span> kFailStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> msg<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> e <span class=\"token operator\">=</span> errno<span class=\"token punctuation\">;</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vfprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" (errno %d)\\n\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span>kRetryStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token class-name\">uint64_t</span> <span class=\"token function\">current_time_ms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">timespec</span> ts<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">clock_gettime</span><span class=\"token punctuation\">(</span>CLOCK_MONOTONIC<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>ts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"clock_gettime failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token punctuation\">)</span>ts<span class=\"token punctuation\">.</span>tv_sec <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token punctuation\">)</span>ts<span class=\"token punctuation\">.</span>tv_nsec <span class=\"token operator\">/</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">use_temporary_dir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> tmpdir_template<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"./syzkaller.XXXXXX\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span><span class=\"token operator\">*</span> tmpdir <span class=\"token operator\">=</span> <span class=\"token function\">mkdtemp</span><span class=\"token punctuation\">(</span>tmpdir_template<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>tmpdir<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to mkdtemp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chmod</span><span class=\"token punctuation\">(</span>tmpdir<span class=\"token punctuation\">,</span> <span class=\"token number\">0777</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chmod\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span>tmpdir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sandbox_common</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">prctl</span><span class=\"token punctuation\">(</span>PR_SET_PDEATHSIG<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setpgrp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setsid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">rlimit</span> rlim<span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_AS<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">8</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_MEMLOCK<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_FSIZE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_STACK<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_CORE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CLONE_NEWCGROUP</span> <span class=\"token expression\"><span class=\"token number\">0x02000000</span></span></span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWNS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWIPC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWCGROUP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWUTS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_SYSVSEM<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">do_sandbox_none</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWPID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">int</span> pid <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sandbox fork failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> pid<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">sandbox_common</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWNET<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">XT_TABLE_SIZE</span> <span class=\"token expression\"><span class=\"token number\">1536</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">XT_MAX_ENTRIES</span> <span class=\"token expression\"><span class=\"token number\">10</span></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">uint64_t</span> pcnt<span class=\"token punctuation\">,</span> bcnt<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_getinfo</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_get_entries</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_replace</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span><span class=\"token operator\">*</span> counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_replace</span> replace<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span> ipv4_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nat\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"mangle\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"raw\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"security\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span> ipv6_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nat\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"mangle\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"raw\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"security\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_BASE_CTL</span> <span class=\"token expression\"><span class=\"token number\">64</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_SO_SET_REPLACE</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>IPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_SO_GET_INFO</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>IPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_SO_GET_ENTRIES</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>IPT_BASE_CTL <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_getinfo</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_get_entries</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_replace</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span><span class=\"token operator\">*</span> counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_replace</span> replace<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span> arpt_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_BASE_CTL</span> <span class=\"token expression\"><span class=\"token number\">96</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_SO_SET_REPLACE</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>ARPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_SO_GET_INFO</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>ARPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_SO_GET_ENTRIES</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>ARPT_BASE_CTL <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_iptables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> family<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> level<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>family<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(%d, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">,</span> family<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> num_tables<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>errno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">case</span> EPERM<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOENT<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOPROTOOPT<span class=\"token operator\">:</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table size is too large: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">></span> XT_MAX_ENTRIES<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"too many counters: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_iptables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> family<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> level<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span> counters<span class=\"token punctuation\">[</span>XT_MAX_ENTRIES<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>family<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(%d, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">,</span> family<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> num_tables<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> entries<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>counters <span class=\"token operator\">=</span> counters<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_SET_REPLACE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setsockopt(IPT_SO_SET_REPLACE)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_arptables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>arpt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>errno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">case</span> EPERM<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOENT<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOPROTOOPT<span class=\"token operator\">:</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table size is too large: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">></span> XT_MAX_ENTRIES<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"too many counters: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_arptables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span> counters<span class=\"token punctuation\">[</span>XT_MAX_ENTRIES<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>arpt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> entries<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>counters <span class=\"token operator\">=</span> counters<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_SET_REPLACE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setsockopt(ARPT_SO_SET_REPLACE)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/if.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/netfilter_bridge/ebtables.h></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_replace</span> replace<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span> ebt_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nat\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"broute\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>ebt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_INIT_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>errno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">case</span> EPERM<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOENT<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOPROTOOPT<span class=\"token operator\">:</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_INIT_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size <span class=\"token operator\">></span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table size is too large: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>entrytable<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_INIT_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_INIT_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_replace</span> replace<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>ebt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\treplace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>h <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> h <span class=\"token operator\">&lt;</span> NF_BR_NUMHOOKS<span class=\"token punctuation\">;</span> h<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">[</span>h<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entrytable<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\treplace<span class=\"token punctuation\">.</span>entries <span class=\"token operator\">=</span> entrytable<span class=\"token punctuation\">;</span>\n\t\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>entrytable<span class=\"token punctuation\">,</span> entrytable<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> h <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> h <span class=\"token operator\">&lt;</span> NF_BR_NUMHOOKS<span class=\"token punctuation\">;</span> h<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">[</span>h<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_entries</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>table<span class=\"token operator\">-></span>entrytable <span class=\"token operator\">+</span> j<span class=\"token punctuation\">;</span>\n\t\t\t\tj<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_SET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setsockopt(EBT_SO_SET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">checkpoint_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_arptables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_iptables</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_iptables</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET6<span class=\"token punctuation\">,</span> SOL_IPV6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">reset_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">reset_arptables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">reset_iptables</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">reset_iptables</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET6<span class=\"token punctuation\">,</span> SOL_IPV6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">remove_dir</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> dir<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tDIR<span class=\"token operator\">*</span> dp<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">dirent</span><span class=\"token operator\">*</span> ep<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> iter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nretry<span class=\"token operator\">:</span>\n\tdp <span class=\"token operator\">=</span> <span class=\"token function\">opendir</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dp <span class=\"token operator\">==</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EMFILE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opendir(%s) failed due to NOFILE, exiting\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opendir(%s) failed\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ep <span class=\"token operator\">=</span> <span class=\"token function\">readdir</span><span class=\"token punctuation\">(</span>dp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">strcmp</span><span class=\"token punctuation\">(</span>ep<span class=\"token operator\">-></span>d_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> <span class=\"token function\">strcmp</span><span class=\"token punctuation\">(</span>ep<span class=\"token operator\">-></span>d_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"..\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">char</span> filename<span class=\"token punctuation\">[</span>FILENAME_MAX<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">snprintf</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%s/%s\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">,</span> ep<span class=\"token operator\">-></span>d_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">stat</span> st<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">lstat</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>st<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lstat(%s) failed\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">S_ISDIR</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">.</span>st_mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">remove_dir</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EROFS<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">!=</span> EBUSY <span class=\"token operator\">||</span> i <span class=\"token operator\">></span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unlink(%s) failed\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">umount2</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> MNT_DETACH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"umount(%s) failed\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">closedir</span><span class=\"token punctuation\">(</span>dp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">rmdir</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EROFS<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EBUSY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">umount2</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">,</span> MNT_DETACH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"umount(%s) failed\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> ENOTEMPTY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>iter <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\titer<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t<span class=\"token keyword\">goto</span> retry<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rmdir(%s) failed\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> iter<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>iter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> iter<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">char</span> cwdbuf<span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">,</span> <span class=\"token string\">\"./%d\"</span><span class=\"token punctuation\">,</span> iter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">,</span> <span class=\"token number\">0777</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to mkdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">int</span> pid <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"loop fork failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">prctl</span><span class=\"token punctuation\">(</span>PR_SET_PDEATHSIG<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">setpgrp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">int</span> status <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">uint64_t</span> start <span class=\"token operator\">=</span> <span class=\"token function\">current_time_ms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">int</span> res <span class=\"token operator\">=</span> <span class=\"token function\">waitpid</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">,</span> __WALL <span class=\"token operator\">|</span> WNOHANG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">==</span> pid<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">usleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">current_time_ms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start <span class=\"token operator\">></span> <span class=\"token number\">5</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">kill</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>pid<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">kill</span><span class=\"token punctuation\">(</span>pid<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">waitpid</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">,</span> __WALL<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> pid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">remove_dir</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">reset_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">uint64_t</span> procid<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_pipe2<span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000040</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_mmap<span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1000000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x32</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>cwd <span class=\"token operator\">=</span> <span class=\"token function\">get_current_dir_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>procid <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> procid <span class=\"token operator\">&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> procid<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span>cwd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">use_temporary_dir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">int</span> pid <span class=\"token operator\">=</span> <span class=\"token function\">do_sandbox_none</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">int</span> status <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">waitpid</span><span class=\"token punctuation\">(</span>pid<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">,</span> __WALL<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> pid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>funny, just one call, <code class=\"language-text\">pipe2</code>.</p>\n<h2 id=\"do_irq---alloca-out-of-bounds\" style=\"position:relative;\"><a href=\"#do_irq---alloca-out-of-bounds\" aria-label=\"do_irq   alloca out of bounds permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>do_irq - alloca Out Of Bounds</h2>\n<h3 id=\"call-trace-dump-1\" style=\"position:relative;\"><a href=\"#call-trace-dump-1\" aria-label=\"call trace dump 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Call Trace (Dump)</h3>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">[</span>  <span class=\"token number\">144.100193</span><span class=\"token punctuation\">]</span> BUG<span class=\"token operator\">:</span> KASAN<span class=\"token operator\">:</span> alloca<span class=\"token operator\">-</span>out<span class=\"token operator\">-</span>of<span class=\"token operator\">-</span>bounds in do_IRQ<span class=\"token operator\">+</span><span class=\"token number\">0x14f</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.102273</span><span class=\"token punctuation\">]</span> Read of size <span class=\"token number\">8</span> at addr ffff880071feef50 by task syz<span class=\"token operator\">-</span>executor7<span class=\"token operator\">/</span><span class=\"token number\">3009</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.105120</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.105718</span><span class=\"token punctuation\">]</span> CPU<span class=\"token operator\">:</span> <span class=\"token number\">0</span> PID<span class=\"token operator\">:</span> <span class=\"token number\">3009</span> Comm<span class=\"token operator\">:</span> syz<span class=\"token operator\">-</span>executor7 Not tainted <span class=\"token number\">4.16</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc3<span class=\"token operator\">+</span> #<span class=\"token number\">5</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.108306</span><span class=\"token punctuation\">]</span> Hardware name<span class=\"token operator\">:</span> QEMU Standard <span class=\"token function\">PC</span> <span class=\"token punctuation\">(</span>i440FX <span class=\"token operator\">+</span> PIIX<span class=\"token punctuation\">,</span> <span class=\"token number\">1996</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BIOS <span class=\"token number\">1.10</span><span class=\"token number\">.2</span><span class=\"token operator\">-</span><span class=\"token number\">1u</span>buntu1 <span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">01</span><span class=\"token operator\">/</span><span class=\"token number\">2014</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.111094</span><span class=\"token punctuation\">]</span> Call Trace<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.111818</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">&lt;</span>IRQ<span class=\"token operator\">></span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.112451</span><span class=\"token punctuation\">]</span>  dump_stack<span class=\"token operator\">+</span><span class=\"token number\">0x127</span><span class=\"token operator\">/</span><span class=\"token number\">0x213</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.113456</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _atomic_dec_and_lock<span class=\"token operator\">+</span><span class=\"token number\">0x18d</span><span class=\"token operator\">/</span><span class=\"token number\">0x18d</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.115195</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> show_regs_print_info<span class=\"token operator\">+</span><span class=\"token number\">0x12</span><span class=\"token operator\">/</span><span class=\"token number\">0x12</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.117092</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_IRQ<span class=\"token operator\">+</span><span class=\"token number\">0x14f</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.118988</span><span class=\"token punctuation\">]</span>  print_address_description<span class=\"token operator\">+</span><span class=\"token number\">0x60</span><span class=\"token operator\">/</span><span class=\"token number\">0x22b</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.121262</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_IRQ<span class=\"token operator\">+</span><span class=\"token number\">0x14f</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.122434</span><span class=\"token punctuation\">]</span>  kasan_report<span class=\"token punctuation\">.</span>cold<span class=\"token punctuation\">.</span><span class=\"token number\">6</span><span class=\"token operator\">+</span><span class=\"token number\">0xac</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f4</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.123688</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_IRQ<span class=\"token operator\">+</span><span class=\"token number\">0x14f</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.125633</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> common_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0xf</span><span class=\"token operator\">/</span><span class=\"token number\">0xf</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.128281</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>IRQ<span class=\"token operator\">></span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.129024</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> crypto_shash_update<span class=\"token operator\">+</span><span class=\"token number\">0x23d</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.133518</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> kasan_unpoison_shadow<span class=\"token operator\">+</span><span class=\"token number\">0x4</span><span class=\"token operator\">/</span><span class=\"token number\">0x40</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.134680</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> crypto_shash_update<span class=\"token operator\">+</span><span class=\"token number\">0x24d</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.135996</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_inode_csum<span class=\"token punctuation\">.</span>isra<span class=\"token punctuation\">.</span><span class=\"token number\">59</span><span class=\"token operator\">+</span><span class=\"token number\">0x562</span><span class=\"token operator\">/</span><span class=\"token number\">0xef0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.137176</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_journalled_zero_new_buffers<span class=\"token operator\">+</span><span class=\"token number\">0x4e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4e0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.138826</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _rcu_barrier<span class=\"token operator\">+</span><span class=\"token number\">0x1850</span><span class=\"token operator\">/</span><span class=\"token number\">0x1d60</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.147204</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _cond_resched<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.148327</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _cond_resched<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.149289</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __getblk_gfp<span class=\"token operator\">+</span><span class=\"token number\">0xf2</span><span class=\"token operator\">/</span><span class=\"token number\">0xa30</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.150261</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.151229</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> map_id_up<span class=\"token operator\">+</span><span class=\"token number\">0x178</span><span class=\"token operator\">/</span><span class=\"token number\">0x3a0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.152122</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> make_kprojid<span class=\"token operator\">+</span><span class=\"token number\">0x30</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.152970</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_downgrade<span class=\"token operator\">+</span><span class=\"token number\">0x6d0</span><span class=\"token operator\">/</span><span class=\"token number\">0x6d0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.153854</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> find_held_lock<span class=\"token operator\">+</span><span class=\"token number\">0x33</span><span class=\"token operator\">/</span><span class=\"token number\">0x1b0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.154777</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> from_kprojid<span class=\"token operator\">+</span><span class=\"token number\">0x89</span><span class=\"token operator\">/</span><span class=\"token number\">0xc0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.155620</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_inode_csum_set<span class=\"token operator\">+</span><span class=\"token number\">0x17c</span><span class=\"token operator\">/</span><span class=\"token number\">0x370</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.156750</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_mark_iloc_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x1709</span><span class=\"token operator\">/</span><span class=\"token number\">0x2cc0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.158064</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_chunk_trans_blocks<span class=\"token operator\">+</span><span class=\"token number\">0x20</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.159246</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_write_access_granted<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">8</span><span class=\"token operator\">+</span><span class=\"token number\">0x264</span><span class=\"token operator\">/</span><span class=\"token number\">0x410</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.163218</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_file_inode<span class=\"token operator\">+</span><span class=\"token number\">0x5d0</span><span class=\"token operator\">/</span><span class=\"token number\">0x5d0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.164486</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_note_context_switch<span class=\"token operator\">+</span><span class=\"token number\">0x710</span><span class=\"token operator\">/</span><span class=\"token number\">0x710</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.165676</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_get_write_access<span class=\"token operator\">+</span><span class=\"token number\">0x98</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.166916</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __ext4_journal_get_write_access<span class=\"token operator\">+</span><span class=\"token number\">0x143</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.168336</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_mark_inode_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x220</span><span class=\"token operator\">/</span><span class=\"token number\">0xac0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.169455</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_evict_inode<span class=\"token operator\">+</span><span class=\"token number\">0xb33</span><span class=\"token operator\">/</span><span class=\"token number\">0x19d0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.170611</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_expand_extra_isize<span class=\"token operator\">+</span><span class=\"token number\">0x560</span><span class=\"token operator\">/</span><span class=\"token number\">0x560</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.171777</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __lock_is_held<span class=\"token operator\">+</span><span class=\"token number\">0xad</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.172798</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_xattr_ensure_credits<span class=\"token operator\">+</span><span class=\"token number\">0x81</span><span class=\"token operator\">/</span><span class=\"token number\">0x320</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.173967</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_xattr_delete_inode<span class=\"token operator\">+</span><span class=\"token number\">0x269</span><span class=\"token operator\">/</span><span class=\"token number\">0xe20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.175159</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_evict_inode<span class=\"token operator\">+</span><span class=\"token number\">0x8f6</span><span class=\"token operator\">/</span><span class=\"token number\">0x19d0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.176233</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_expand_extra_isize_ea<span class=\"token operator\">+</span><span class=\"token number\">0x1a20</span><span class=\"token operator\">/</span><span class=\"token number\">0x1a20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.177557</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __sb_start_write<span class=\"token operator\">+</span><span class=\"token number\">0x16b</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.178698</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __sb_start_write<span class=\"token operator\">+</span><span class=\"token number\">0x171</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.179765</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_evict_inode<span class=\"token operator\">+</span><span class=\"token number\">0xb33</span><span class=\"token operator\">/</span><span class=\"token number\">0x19d0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.180905</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_da_write_begin<span class=\"token operator\">+</span><span class=\"token number\">0x1170</span><span class=\"token operator\">/</span><span class=\"token number\">0x1170</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.182053</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> evict<span class=\"token operator\">+</span><span class=\"token number\">0x45f</span><span class=\"token operator\">/</span><span class=\"token number\">0x8f0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.182904</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x4a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.183842</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> wb_wakeup<span class=\"token operator\">+</span><span class=\"token number\">0xc0</span><span class=\"token operator\">/</span><span class=\"token number\">0xc0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.184705</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_raw_spin_trylock<span class=\"token operator\">+</span><span class=\"token number\">0x190</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.185652</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> bit_waitqueue<span class=\"token operator\">+</span><span class=\"token number\">0x30</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.186414</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_da_write_begin<span class=\"token operator\">+</span><span class=\"token number\">0x1170</span><span class=\"token operator\">/</span><span class=\"token number\">0x1170</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.187468</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> evict<span class=\"token operator\">+</span><span class=\"token number\">0x498</span><span class=\"token operator\">/</span><span class=\"token number\">0x8f0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.188398</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> destroy_inode<span class=\"token operator\">+</span><span class=\"token number\">0x1e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x1e0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.189355</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> iput<span class=\"token operator\">+</span><span class=\"token number\">0x623</span><span class=\"token operator\">/</span><span class=\"token number\">0xbc0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.193860</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x4a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.202122</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_read_lock_sched_held<span class=\"token operator\">+</span><span class=\"token number\">0x102</span><span class=\"token operator\">/</span><span class=\"token number\">0x120</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.203252</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_drop_inode<span class=\"token operator\">+</span><span class=\"token number\">0x11e</span><span class=\"token operator\">/</span><span class=\"token number\">0x400</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.204290</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_raw_spin_trylock<span class=\"token operator\">+</span><span class=\"token number\">0x190</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.205489</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _atomic_dec_and_lock<span class=\"token operator\">+</span><span class=\"token number\">0xff</span><span class=\"token operator\">/</span><span class=\"token number\">0x18d</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.207104</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> cpumask_local_spread<span class=\"token operator\">+</span><span class=\"token number\">0x2c0</span><span class=\"token operator\">/</span><span class=\"token number\">0x2c0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.210166</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> fsnotify_grab_connector<span class=\"token operator\">+</span><span class=\"token number\">0x18c</span><span class=\"token operator\">/</span><span class=\"token number\">0x2e0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.212062</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> iput<span class=\"token operator\">+</span><span class=\"token number\">0x62b</span><span class=\"token operator\">/</span><span class=\"token number\">0xbc0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.213507</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_sync_fs<span class=\"token operator\">+</span><span class=\"token number\">0xa00</span><span class=\"token operator\">/</span><span class=\"token number\">0xa00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.215476</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> dispose_list<span class=\"token operator\">+</span><span class=\"token number\">0x390</span><span class=\"token operator\">/</span><span class=\"token number\">0x390</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.220125</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> fsnotify_grab_connector<span class=\"token operator\">+</span><span class=\"token number\">0x1bd</span><span class=\"token operator\">/</span><span class=\"token number\">0x2e0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.223298</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> fsnotify_recalc_mask<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">8</span><span class=\"token operator\">+</span><span class=\"token number\">0xa0</span><span class=\"token operator\">/</span><span class=\"token number\">0xa0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.230135</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> fsnotify_first_mark<span class=\"token operator\">+</span><span class=\"token number\">0x340</span><span class=\"token operator\">/</span><span class=\"token number\">0x340</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.231357</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> dentry_unlink_inode<span class=\"token operator\">+</span><span class=\"token number\">0x483</span><span class=\"token operator\">/</span><span class=\"token number\">0x5b0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.232384</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> release_dentry_name_snapshot<span class=\"token operator\">+</span><span class=\"token number\">0x70</span><span class=\"token operator\">/</span><span class=\"token number\">0x70</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.233609</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_downgrade<span class=\"token operator\">+</span><span class=\"token number\">0x6d0</span><span class=\"token operator\">/</span><span class=\"token number\">0x6d0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.234590</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcutorture_record_progress<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.238561</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x4a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.239920</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_raw_spin_lock<span class=\"token operator\">+</span><span class=\"token number\">0x1b0</span><span class=\"token operator\">/</span><span class=\"token number\">0x1b0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.241197</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> dput<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">24</span><span class=\"token operator\">+</span><span class=\"token number\">0x23d</span><span class=\"token operator\">/</span><span class=\"token number\">0x950</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.242177</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> d_delete<span class=\"token operator\">+</span><span class=\"token number\">0x1ed</span><span class=\"token operator\">/</span><span class=\"token number\">0x2c0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.243104</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> vfs_rmdir<span class=\"token operator\">+</span><span class=\"token number\">0x386</span><span class=\"token operator\">/</span><span class=\"token number\">0x470</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.244475</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_rmdir<span class=\"token operator\">+</span><span class=\"token number\">0x41c</span><span class=\"token operator\">/</span><span class=\"token number\">0x5b0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.245746</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> user_path_create<span class=\"token operator\">+</span><span class=\"token number\">0x40</span><span class=\"token operator\">/</span><span class=\"token number\">0x40</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.247270</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __do_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x4a3</span><span class=\"token operator\">/</span><span class=\"token number\">0xe30</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.248801</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> exit_to_usermode_loop<span class=\"token operator\">+</span><span class=\"token number\">0x16d</span><span class=\"token operator\">/</span><span class=\"token number\">0x230</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.250478</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> exit_to_usermode_loop<span class=\"token operator\">+</span><span class=\"token number\">0x1c6</span><span class=\"token operator\">/</span><span class=\"token number\">0x230</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.251700</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> syscall_slow_exit_work<span class=\"token operator\">+</span><span class=\"token number\">0x4d0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4d0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.252955</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_syscall_64<span class=\"token operator\">+</span><span class=\"token number\">0xb0</span><span class=\"token operator\">/</span><span class=\"token number\">0x850</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.254232</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> SyS_mkdir<span class=\"token operator\">+</span><span class=\"token number\">0x2c0</span><span class=\"token operator\">/</span><span class=\"token number\">0x2c0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.255074</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_syscall_64<span class=\"token operator\">+</span><span class=\"token number\">0x25b</span><span class=\"token operator\">/</span><span class=\"token number\">0x850</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.255911</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> exit_to_usermode_loop<span class=\"token operator\">+</span><span class=\"token number\">0x1c6</span><span class=\"token operator\">/</span><span class=\"token number\">0x230</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.257570</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> syscall_return_slowpath<span class=\"token operator\">+</span><span class=\"token number\">0x4e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4e0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.259317</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> syscall_return_slowpath<span class=\"token operator\">+</span><span class=\"token number\">0x342</span><span class=\"token operator\">/</span><span class=\"token number\">0x4e0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.261118</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> entry_SYSCALL_64_after_hwframe<span class=\"token operator\">+</span><span class=\"token number\">0x52</span><span class=\"token operator\">/</span><span class=\"token number\">0xb7</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.263090</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_off_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.264816</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> entry_SYSCALL_64_after_hwframe<span class=\"token operator\">+</span><span class=\"token number\">0x42</span><span class=\"token operator\">/</span><span class=\"token number\">0xb7</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.266695</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.267257</span><span class=\"token punctuation\">]</span> The buggy address belongs to the page<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.268975</span><span class=\"token punctuation\">]</span> page<span class=\"token operator\">:</span>ffffea0001c7fb80 count<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapcount<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapping<span class=\"token operator\">:</span><span class=\"token number\">0000000000000000</span> index<span class=\"token operator\">:</span><span class=\"token number\">0x0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.271861</span><span class=\"token punctuation\">]</span> flags<span class=\"token operator\">:</span> <span class=\"token number\">0x500000000000000</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.273191</span><span class=\"token punctuation\">]</span> raw<span class=\"token operator\">:</span> <span class=\"token number\">0500000000000000</span> <span class=\"token number\">0000000000000000</span> <span class=\"token number\">0000000000000000</span> <span class=\"token number\">00000000ffff</span>ffff\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.275851</span><span class=\"token punctuation\">]</span> raw<span class=\"token operator\">:</span> ffffea0001c7fba0 ffffea0001c7fba0 <span class=\"token number\">0000000000000000</span> <span class=\"token number\">0000000000000000</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.278015</span><span class=\"token punctuation\">]</span> page dumped because<span class=\"token operator\">:</span> kasan<span class=\"token operator\">:</span> bad access detected\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.279598</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.280163</span><span class=\"token punctuation\">]</span> Memory state around the buggy address<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.281388</span><span class=\"token punctuation\">]</span>  ffff880071feee00<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.283488</span><span class=\"token punctuation\">]</span>  ffff880071feee80<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.285237</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">></span>ffff880071feef00<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> ca ca ca ca <span class=\"token number\">02</span> cb cb cb cb cb cb cb\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.287223</span><span class=\"token punctuation\">]</span>                                                  <span class=\"token operator\">^</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.288617</span><span class=\"token punctuation\">]</span>  ffff880071feef80<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.290465</span><span class=\"token punctuation\">]</span>  ffff880071fef000<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> f1 f1 f1 f1 <span class=\"token number\">02</span> f2 f2 f2 f2 f2 f2 f2\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.292215</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.296633</span><span class=\"token punctuation\">]</span> Disabling lock debugging due to kernel taint\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">144.297823</span><span class=\"token punctuation\">]</span> Kernel panic <span class=\"token operator\">-</span> not syncing<span class=\"token operator\">:</span> panic_on_warn set <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h3 id=\"poc-1\" style=\"position:relative;\"><a href=\"#poc-1\" aria-label=\"poc 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PoC</h3>\n<p>generated by syz-repro.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_GNU_SOURCE</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;endian.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/syscall.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/futex.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;pthread.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;signal.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/time.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/wait.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;time.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/prctl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;dirent.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/mount.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sched.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;signal.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdbool.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/prctl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/resource.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/time.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/wait.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;grp.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;arpa/inet.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;fcntl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/if.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/if_ether.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/if_tun.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/ip.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/tcp.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;net/if_arp.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdbool.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/ioctl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/stat.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/uio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/net.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;netinet/in.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/socket.h></span></span>\n\n<span class=\"token keyword\">__attribute__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>noreturn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> status<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">volatile</span> <span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_exit_group<span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdint.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/stat.h></span></span>\n\n<span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> kFailStatus <span class=\"token operator\">=</span> <span class=\"token number\">67</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> kRetryStatus <span class=\"token operator\">=</span> <span class=\"token number\">69</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> msg<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> e <span class=\"token operator\">=</span> errno<span class=\"token punctuation\">;</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vfprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" (errno %d)\\n\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">==</span> ENOMEM <span class=\"token operator\">||</span> e <span class=\"token operator\">==</span> EAGAIN<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> kRetryStatus <span class=\"token operator\">:</span> kFailStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> msg<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> e <span class=\"token operator\">=</span> errno<span class=\"token punctuation\">;</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vfprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" (errno %d)\\n\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span>kRetryStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token class-name\">uint64_t</span> <span class=\"token function\">current_time_ms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">timespec</span> ts<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">clock_gettime</span><span class=\"token punctuation\">(</span>CLOCK_MONOTONIC<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>ts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"clock_gettime failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token punctuation\">)</span>ts<span class=\"token punctuation\">.</span>tv_sec <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token punctuation\">)</span>ts<span class=\"token punctuation\">.</span>tv_nsec <span class=\"token operator\">/</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">use_temporary_dir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> tmpdir_template<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"./syzkaller.XXXXXX\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span><span class=\"token operator\">*</span> tmpdir <span class=\"token operator\">=</span> <span class=\"token function\">mkdtemp</span><span class=\"token punctuation\">(</span>tmpdir_template<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>tmpdir<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to mkdtemp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chmod</span><span class=\"token punctuation\">(</span>tmpdir<span class=\"token punctuation\">,</span> <span class=\"token number\">0777</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chmod\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span>tmpdir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">vsnprintf_check</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span> str<span class=\"token punctuation\">,</span> <span class=\"token class-name\">size_t</span> size<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> format<span class=\"token punctuation\">,</span> va_list args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> rv<span class=\"token punctuation\">;</span>\n\n\trv <span class=\"token operator\">=</span> <span class=\"token function\">vsnprintf</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rv <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: snprintf failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">size_t</span><span class=\"token punctuation\">)</span>rv <span class=\"token operator\">>=</span> size<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: string '%s...' doesn't fit into buffer\"</span><span class=\"token punctuation\">,</span> str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">snprintf_check</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span> str<span class=\"token punctuation\">,</span> <span class=\"token class-name\">size_t</span> size<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> format<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vsnprintf_check</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">COMMAND_MAX_LEN</span> <span class=\"token expression\"><span class=\"token number\">128</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">PATH_PREFIX</span> <span class=\"token string\">\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">PATH_PREFIX_LEN</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>PATH_PREFIX<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span>bool panic<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> format<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> command<span class=\"token punctuation\">[</span>PATH_PREFIX_LEN <span class=\"token operator\">+</span> COMMAND_MAX_LEN<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> rv<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">,</span> PATH_PREFIX<span class=\"token punctuation\">,</span> PATH_PREFIX_LEN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vsnprintf_check</span><span class=\"token punctuation\">(</span>command <span class=\"token operator\">+</span> PATH_PREFIX_LEN<span class=\"token punctuation\">,</span> COMMAND_MAX_LEN<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trv <span class=\"token operator\">=</span> <span class=\"token function\">system</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>panic <span class=\"token operator\">&amp;&amp;</span> rv <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: command \\\"%s\\\" failed with code %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>command<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> rv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> tunfd <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> tun_frags_enabled<span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SYZ_TUN_MAX_PACKET_SIZE</span> <span class=\"token expression\"><span class=\"token number\">1000</span></span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">TUN_IFACE</span> <span class=\"token string\">\"syz_tun\"</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">LOCAL_MAC</span> <span class=\"token string\">\"aa:aa:aa:aa:aa:aa\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">REMOTE_MAC</span> <span class=\"token string\">\"aa:aa:aa:aa:aa:bb\"</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">LOCAL_IPV4</span> <span class=\"token string\">\"172.20.20.170\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">REMOTE_IPV4</span> <span class=\"token string\">\"172.20.20.187\"</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">LOCAL_IPV6</span> <span class=\"token string\">\"fe80::aa\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">REMOTE_IPV6</span> <span class=\"token string\">\"fe80::bb\"</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IFF_NAPI</span> <span class=\"token expression\"><span class=\"token number\">0x0010</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IFF_NAPI_FRAGS</span> <span class=\"token expression\"><span class=\"token number\">0x0020</span></span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize_tun</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\ttunfd <span class=\"token operator\">=</span> <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dev/net/tun\"</span><span class=\"token punctuation\">,</span> O_RDWR <span class=\"token operator\">|</span> O_NONBLOCK<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tunfd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: can't open /dev/net/tun: please enable CONFIG_TUN=y\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"otherwise fuzzing or reproducing might not work as intended\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> kTunFd <span class=\"token operator\">=</span> <span class=\"token number\">252</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">dup2</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> kTunFd<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dup2(tunfd, kTunFd) failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ttunfd <span class=\"token operator\">=</span> kTunFd<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ifreq</span> ifr<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ifr<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ifr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">strncpy</span><span class=\"token punctuation\">(</span>ifr<span class=\"token punctuation\">.</span>ifr_name<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">,</span> IFNAMSIZ<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tifr<span class=\"token punctuation\">.</span>ifr_flags <span class=\"token operator\">=</span> IFF_TAP <span class=\"token operator\">|</span> IFF_NO_PI <span class=\"token operator\">|</span> IFF_NAPI <span class=\"token operator\">|</span> IFF_NAPI_FRAGS<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ioctl</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> TUNSETIFF<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>ifr<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tifr<span class=\"token punctuation\">.</span>ifr_flags <span class=\"token operator\">=</span> IFF_TAP <span class=\"token operator\">|</span> IFF_NO_PI<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ioctl</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> TUNSETIFF<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>ifr<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: ioctl(TUNSETIFF) failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ioctl</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> TUNGETIFF<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>ifr<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: ioctl(TUNGETIFF) failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ttun_frags_enabled <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ifr<span class=\"token punctuation\">.</span>ifr_flags <span class=\"token operator\">&amp;</span> IFF_NAPI_FRAGS<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sysctl -w net.ipv6.conf.%s.accept_dad=0\"</span><span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sysctl -w net.ipv6.conf.%s.router_solicitations=0\"</span><span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link set dev %s address %s\"</span><span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">,</span> LOCAL_MAC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip addr add %s/24 dev %s\"</span><span class=\"token punctuation\">,</span> LOCAL_IPV4<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip -6 addr add %s/120 dev %s\"</span><span class=\"token punctuation\">,</span> LOCAL_IPV6<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip neigh add %s lladdr %s dev %s nud permanent\"</span><span class=\"token punctuation\">,</span>\n\t\t\tREMOTE_IPV4<span class=\"token punctuation\">,</span> REMOTE_MAC<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip -6 neigh add %s lladdr %s dev %s nud permanent\"</span><span class=\"token punctuation\">,</span>\n\t\t\tREMOTE_IPV6<span class=\"token punctuation\">,</span> REMOTE_MAC<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link set dev %s up\"</span><span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DEV_IPV4</span> <span class=\"token string\">\"172.20.20.%d\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DEV_IPV6</span> <span class=\"token string\">\"fe80::%02hx\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DEV_MAC</span> <span class=\"token string\">\"aa:aa:aa:aa:aa:%02hx\"</span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize_netdevices</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> devtypes<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"ip6gretap\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bridge\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"vcan\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bond\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"veth\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> devnames<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"lo\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sit0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bridge0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"vcan0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"tunl0\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t  <span class=\"token string\">\"gre0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"gretap0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip_vti0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip6_vti0\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t  <span class=\"token string\">\"ip6tnl0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip6gre0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip6gretap0\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t  <span class=\"token string\">\"erspan0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bond0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"veth0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"veth1\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>devtypes<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>devtypes<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link add dev %s0 type %s\"</span><span class=\"token punctuation\">,</span> devtypes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> devtypes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link add dev veth1 type veth\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>devnames<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>devnames<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">char</span> addr<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">snprintf_check</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> DEV_IPV4<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip -4 addr add %s/24 dev %s\"</span><span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">,</span> devnames<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">snprintf_check</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> DEV_IPV6<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip -6 addr add %s/120 dev %s\"</span><span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">,</span> devnames<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">snprintf_check</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> DEV_MAC<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link set dev %s address %s\"</span><span class=\"token punctuation\">,</span> devnames<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link set dev %s up\"</span><span class=\"token punctuation\">,</span> devnames<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read_tun</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span> data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tunfd <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">int</span> rv <span class=\"token operator\">=</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rv <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EAGAIN<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EBADFD<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: read failed with %d\"</span><span class=\"token punctuation\">,</span> rv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> rv<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">flush_tun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> data<span class=\"token punctuation\">[</span>SYZ_TUN_MAX_PACKET_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">read_tun</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sandbox_common</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">prctl</span><span class=\"token punctuation\">(</span>PR_SET_PDEATHSIG<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setpgrp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setsid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">rlimit</span> rlim<span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_AS<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">8</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_MEMLOCK<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_FSIZE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_STACK<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trlim<span class=\"token punctuation\">.</span>rlim_cur <span class=\"token operator\">=</span> rlim<span class=\"token punctuation\">.</span>rlim_max <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">setrlimit</span><span class=\"token punctuation\">(</span>RLIMIT_CORE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>rlim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">CLONE_NEWCGROUP</span> <span class=\"token expression\"><span class=\"token number\">0x02000000</span></span></span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWNS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWIPC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWCGROUP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWUTS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_SYSVSEM<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">do_sandbox_setuid</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWPID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unshare(CLONE_NEWPID)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> pid <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sandbox fork failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> pid<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">sandbox_common</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unshare</span><span class=\"token punctuation\">(</span>CLONE_NEWNET<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unshare(CLONE_NEWNET)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">initialize_tun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">initialize_netdevices</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> nobody <span class=\"token operator\">=</span> <span class=\"token number\">65534</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setgroups</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to setgroups\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>SYS_setresgid<span class=\"token punctuation\">,</span> nobody<span class=\"token punctuation\">,</span> nobody<span class=\"token punctuation\">,</span> nobody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to setresgid\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>SYS_setresuid<span class=\"token punctuation\">,</span> nobody<span class=\"token punctuation\">,</span> nobody<span class=\"token punctuation\">,</span> nobody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to setresuid\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">prctl</span><span class=\"token punctuation\">(</span>PR_SET_DUMPABLE<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">XT_TABLE_SIZE</span> <span class=\"token expression\"><span class=\"token number\">1536</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">XT_MAX_ENTRIES</span> <span class=\"token expression\"><span class=\"token number\">10</span></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">uint64_t</span> pcnt<span class=\"token punctuation\">,</span> bcnt<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_getinfo</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_get_entries</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_replace</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span><span class=\"token operator\">*</span> counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_replace</span> replace<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span> ipv4_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nat\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"mangle\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"raw\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"security\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span> ipv6_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nat\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"mangle\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"raw\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"security\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_BASE_CTL</span> <span class=\"token expression\"><span class=\"token number\">64</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_SO_SET_REPLACE</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>IPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_SO_GET_INFO</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>IPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_SO_GET_ENTRIES</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>IPT_BASE_CTL <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_getinfo</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_get_entries</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_replace</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span><span class=\"token operator\">*</span> counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_replace</span> replace<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span> arpt_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_BASE_CTL</span> <span class=\"token expression\"><span class=\"token number\">96</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_SO_SET_REPLACE</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>ARPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_SO_GET_INFO</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>ARPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_SO_GET_ENTRIES</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>ARPT_BASE_CTL <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_iptables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> family<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> level<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>family<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(%d, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">,</span> family<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> num_tables<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>errno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">case</span> EPERM<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOENT<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOPROTOOPT<span class=\"token operator\">:</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table size is too large: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">></span> XT_MAX_ENTRIES<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"too many counters: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_iptables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> family<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> level<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span> counters<span class=\"token punctuation\">[</span>XT_MAX_ENTRIES<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>family<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(%d, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">,</span> family<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> num_tables<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> entries<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>counters <span class=\"token operator\">=</span> counters<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_SET_REPLACE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setsockopt(IPT_SO_SET_REPLACE)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_arptables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>arpt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>errno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">case</span> EPERM<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOENT<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOPROTOOPT<span class=\"token operator\">:</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table size is too large: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">></span> XT_MAX_ENTRIES<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"too many counters: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_arptables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span> counters<span class=\"token punctuation\">[</span>XT_MAX_ENTRIES<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>arpt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> entries<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>counters <span class=\"token operator\">=</span> counters<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_SET_REPLACE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setsockopt(ARPT_SO_SET_REPLACE)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/if.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/netfilter_bridge/ebtables.h></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_replace</span> replace<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span> ebt_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nat\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"broute\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>ebt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_INIT_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>errno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">case</span> EPERM<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOENT<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOPROTOOPT<span class=\"token operator\">:</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_INIT_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size <span class=\"token operator\">></span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table size is too large: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>entrytable<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_INIT_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_INIT_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_replace</span> replace<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>ebt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\treplace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>h <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> h <span class=\"token operator\">&lt;</span> NF_BR_NUMHOOKS<span class=\"token punctuation\">;</span> h<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">[</span>h<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entrytable<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\treplace<span class=\"token punctuation\">.</span>entries <span class=\"token operator\">=</span> entrytable<span class=\"token punctuation\">;</span>\n\t\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>entrytable<span class=\"token punctuation\">,</span> entrytable<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> h <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> h <span class=\"token operator\">&lt;</span> NF_BR_NUMHOOKS<span class=\"token punctuation\">;</span> h<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">[</span>h<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_entries</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>table<span class=\"token operator\">-></span>entrytable <span class=\"token operator\">+</span> j<span class=\"token punctuation\">;</span>\n\t\t\t\tj<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_SET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setsockopt(EBT_SO_SET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">checkpoint_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_arptables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_iptables</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_iptables</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET6<span class=\"token punctuation\">,</span> SOL_IPV6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">reset_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">reset_arptables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">reset_iptables</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">reset_iptables</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET6<span class=\"token punctuation\">,</span> SOL_IPV6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">remove_dir</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> dir<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tDIR<span class=\"token operator\">*</span> dp<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">dirent</span><span class=\"token operator\">*</span> ep<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> iter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nretry<span class=\"token operator\">:</span>\n\tdp <span class=\"token operator\">=</span> <span class=\"token function\">opendir</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dp <span class=\"token operator\">==</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EMFILE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opendir(%s) failed due to NOFILE, exiting\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opendir(%s) failed\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ep <span class=\"token operator\">=</span> <span class=\"token function\">readdir</span><span class=\"token punctuation\">(</span>dp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">strcmp</span><span class=\"token punctuation\">(</span>ep<span class=\"token operator\">-></span>d_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> <span class=\"token function\">strcmp</span><span class=\"token punctuation\">(</span>ep<span class=\"token operator\">-></span>d_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"..\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">char</span> filename<span class=\"token punctuation\">[</span>FILENAME_MAX<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">snprintf</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%s/%s\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">,</span> ep<span class=\"token operator\">-></span>d_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">stat</span> st<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">lstat</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>st<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lstat(%s) failed\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">S_ISDIR</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">.</span>st_mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">remove_dir</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EROFS<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">!=</span> EBUSY <span class=\"token operator\">||</span> i <span class=\"token operator\">></span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unlink(%s) failed\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">umount2</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> MNT_DETACH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"umount(%s) failed\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">closedir</span><span class=\"token punctuation\">(</span>dp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">rmdir</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EROFS<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EBUSY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">umount2</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">,</span> MNT_DETACH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"umount(%s) failed\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> ENOTEMPTY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>iter <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\titer<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t<span class=\"token keyword\">goto</span> retry<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rmdir(%s) failed\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> iter<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>iter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> iter<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">char</span> cwdbuf<span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">,</span> <span class=\"token string\">\"./%d\"</span><span class=\"token punctuation\">,</span> iter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">,</span> <span class=\"token number\">0777</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to mkdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">int</span> pid <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"loop fork failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">prctl</span><span class=\"token punctuation\">(</span>PR_SET_PDEATHSIG<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">setpgrp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">flush_tun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">int</span> status <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">uint64_t</span> start <span class=\"token operator\">=</span> <span class=\"token function\">current_time_ms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">int</span> res <span class=\"token operator\">=</span> <span class=\"token function\">waitpid</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">,</span> __WALL <span class=\"token operator\">|</span> WNOHANG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">==</span> pid<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">usleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">current_time_ms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start <span class=\"token operator\">></span> <span class=\"token number\">5</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">kill</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>pid<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">kill</span><span class=\"token punctuation\">(</span>pid<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">waitpid</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">,</span> __WALL<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> pid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">remove_dir</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">reset_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">thread_t</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> created<span class=\"token punctuation\">,</span> running<span class=\"token punctuation\">,</span> call<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">pthread_t</span> th<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">thread_t</span> threads<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">execute_call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> call<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> running<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> collide<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thr</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> arg<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">thread_t</span><span class=\"token operator\">*</span> th <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">thread_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>arg<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">__atomic_load_n</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>th<span class=\"token operator\">-></span>running<span class=\"token punctuation\">,</span> __ATOMIC_ACQUIRE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>SYS_futex<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>th<span class=\"token operator\">-></span>running<span class=\"token punctuation\">,</span> FUTEX_WAIT<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">execute_call</span><span class=\"token punctuation\">(</span>th<span class=\"token operator\">-></span>call<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">__atomic_fetch_sub</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>running<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> __ATOMIC_RELAXED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">__atomic_store_n</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>th<span class=\"token operator\">-></span>running<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> __ATOMIC_RELEASE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>SYS_futex<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>th<span class=\"token operator\">-></span>running<span class=\"token punctuation\">,</span> FUTEX_WAKE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> num_calls<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> call<span class=\"token punctuation\">,</span> thread<span class=\"token punctuation\">;</span>\n\trunning <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>call <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> call <span class=\"token operator\">&lt;</span> num_calls<span class=\"token punctuation\">;</span> call<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>thread <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> thread <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>threads<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>threads<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> thread<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">thread_t</span><span class=\"token operator\">*</span> th <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>threads<span class=\"token punctuation\">[</span>thread<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>th<span class=\"token operator\">-></span>created<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tth<span class=\"token operator\">-></span>created <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token class-name\">pthread_attr_t</span> attr<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">pthread_attr_init</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>attr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">pthread_attr_setstacksize</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>attr<span class=\"token punctuation\">,</span> <span class=\"token number\">128</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>th<span class=\"token operator\">-></span>th<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>attr<span class=\"token punctuation\">,</span> thr<span class=\"token punctuation\">,</span> th<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">__atomic_load_n</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>th<span class=\"token operator\">-></span>running<span class=\"token punctuation\">,</span> __ATOMIC_ACQUIRE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tth<span class=\"token operator\">-></span>call <span class=\"token operator\">=</span> call<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">__atomic_fetch_add</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>running<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> __ATOMIC_RELAXED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">__atomic_store_n</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>th<span class=\"token operator\">-></span>running<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> __ATOMIC_RELEASE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>SYS_futex<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>th<span class=\"token operator\">-></span>running<span class=\"token punctuation\">,</span> FUTEX_WAKE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>collide <span class=\"token operator\">&amp;&amp;</span> call <span class=\"token operator\">%</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">timespec</span> ts<span class=\"token punctuation\">;</span>\n\t\t\t\tts<span class=\"token punctuation\">.</span>tv_sec <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t\t\tts<span class=\"token punctuation\">.</span>tv_nsec <span class=\"token operator\">=</span> <span class=\"token number\">20</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>SYS_futex<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>th<span class=\"token operator\">-></span>running<span class=\"token punctuation\">,</span> FUTEX_WAIT<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>ts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>running<span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token function\">usleep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>call <span class=\"token operator\">==</span> num_calls <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">10000</span> <span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">uint64_t</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0x0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">uint64_t</span> procid<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">execute_call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> call<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">long</span> res<span class=\"token punctuation\">;</span>\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>call<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span>\n<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000440</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"keyring\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint8_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000480</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x73</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint8_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000481</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x79</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint8_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000482</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7a</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint8_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000483</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint8_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000484</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\tres <span class=\"token operator\">=</span> <span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_add_key<span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000440</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000480</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xfffffffe</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t\t\tr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n\t\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_keyctl<span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span>\n<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000000</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/selinux/enforce\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">17</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tres <span class=\"token operator\">=</span> <span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_openat<span class=\"token punctuation\">,</span> <span class=\"token number\">0xffffffffffffff9c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t\t\tr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span>\n\t\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_ioctl<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x8904</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000040</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span>\n<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint32_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000280</span> <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_getpeername<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000240</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000280</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token operator\">:</span>\n<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint32_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000340</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_getsockopt<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xc</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000340</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tcollide <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_mmap<span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1000000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x32</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>cwd <span class=\"token operator\">=</span> <span class=\"token function\">get_current_dir_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>procid <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> procid <span class=\"token operator\">&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> procid<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span>cwd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">use_temporary_dir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">int</span> pid <span class=\"token operator\">=</span> <span class=\"token function\">do_sandbox_setuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">int</span> status <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">waitpid</span><span class=\"token punctuation\">(</span>pid<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">,</span> __WALL<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> pid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 id=\"unwind_next_frame---alloca-out-of-bounds\" style=\"position:relative;\"><a href=\"#unwind_next_frame---alloca-out-of-bounds\" aria-label=\"unwind_next_frame   alloca out of bounds permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>unwind_next_frame - alloca Out Of Bounds</h2>\n<p>Got from syzkaller &#x26; Found in LK v4.16.0-rc3. But it's not useful info. As before, there's a similar bug that I found.\nAs committer said, this bug is natural and of course not useful stuff.</p>\n<p><em>link</em> : <a href=\"https://kozistr.github.io/2017/12/16/LK-unwind_orc-oob.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">unwind_orc-out_of_bounds</a></p>\n<h3 id=\"call-trace-dump-2\" style=\"position:relative;\"><a href=\"#call-trace-dump-2\" aria-label=\"call trace dump 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Call Trace (Dump)</h3>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">[</span>  <span class=\"token number\">163.982226</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.984549</span><span class=\"token punctuation\">]</span> BUG<span class=\"token operator\">:</span> KASAN<span class=\"token operator\">:</span> alloca<span class=\"token operator\">-</span>out<span class=\"token operator\">-</span>of<span class=\"token operator\">-</span>bounds in unwind_next_frame<span class=\"token operator\">+</span><span class=\"token number\">0x18a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x1920</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.986378</span><span class=\"token punctuation\">]</span> Read of size <span class=\"token number\">8</span> at addr ffff88005a9878c0 by task poc<span class=\"token operator\">/</span><span class=\"token number\">2752</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.987829</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.988229</span><span class=\"token punctuation\">]</span> CPU<span class=\"token operator\">:</span> <span class=\"token number\">0</span> PID<span class=\"token operator\">:</span> <span class=\"token number\">2752</span> Comm<span class=\"token operator\">:</span> poc Not tainted <span class=\"token number\">4.16</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc3<span class=\"token operator\">+</span> #<span class=\"token number\">6</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.989674</span><span class=\"token punctuation\">]</span> Hardware name<span class=\"token operator\">:</span> QEMU Standard <span class=\"token function\">PC</span> <span class=\"token punctuation\">(</span>i440FX <span class=\"token operator\">+</span> PIIX<span class=\"token punctuation\">,</span> <span class=\"token number\">1996</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BIOS <span class=\"token number\">1.10</span><span class=\"token number\">.2</span><span class=\"token operator\">-</span><span class=\"token number\">1u</span>buntu1 <span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">01</span><span class=\"token operator\">/</span><span class=\"token number\">2014</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.991730</span><span class=\"token punctuation\">]</span> Call Trace<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.992180</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">&lt;</span>IRQ<span class=\"token operator\">></span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.992518</span><span class=\"token punctuation\">]</span>  dump_stack<span class=\"token operator\">+</span><span class=\"token number\">0xd7</span><span class=\"token operator\">/</span><span class=\"token number\">0x154</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.993118</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> unwind_next_frame<span class=\"token operator\">+</span><span class=\"token number\">0x18a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x1920</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.994093</span><span class=\"token punctuation\">]</span>  print_address_description<span class=\"token operator\">+</span><span class=\"token number\">0x60</span><span class=\"token operator\">/</span><span class=\"token number\">0x22b</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.995264</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> unwind_next_frame<span class=\"token operator\">+</span><span class=\"token number\">0x18a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x1920</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.996411</span><span class=\"token punctuation\">]</span>  kasan_report<span class=\"token punctuation\">.</span>cold<span class=\"token punctuation\">.</span><span class=\"token number\">6</span><span class=\"token operator\">+</span><span class=\"token number\">0xac</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f4</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.997455</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> unwind_next_frame<span class=\"token operator\">+</span><span class=\"token number\">0x18a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x1920</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.998528</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0xf</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">163.999557</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> deref_stack_reg<span class=\"token operator\">+</span><span class=\"token number\">0xe0</span><span class=\"token operator\">/</span><span class=\"token number\">0xe0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.000293</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0xf</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.001134</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __save_stack_trace<span class=\"token operator\">+</span><span class=\"token number\">0x7d</span><span class=\"token operator\">/</span><span class=\"token number\">0xf0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.001962</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __memset<span class=\"token operator\">+</span><span class=\"token number\">0x29</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.002616</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_stack<span class=\"token operator\">+</span><span class=\"token number\">0x32</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.003298</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __kasan_slab_free<span class=\"token operator\">+</span><span class=\"token number\">0x12c</span><span class=\"token operator\">/</span><span class=\"token number\">0x170</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.004129</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> kmem_cache_free<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.004906</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_process_callbacks<span class=\"token operator\">+</span><span class=\"token number\">0x814</span><span class=\"token operator\">/</span><span class=\"token number\">0x1dc0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.005807</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __do_softirq<span class=\"token operator\">+</span><span class=\"token number\">0x213</span><span class=\"token operator\">/</span><span class=\"token number\">0x915</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.006545</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> irq_exit<span class=\"token operator\">+</span><span class=\"token number\">0x1a2</span><span class=\"token operator\">/</span><span class=\"token number\">0x1d0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.007272</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> smp_apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0xf1</span><span class=\"token operator\">/</span><span class=\"token number\">0x500</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.008520</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0xf</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.009794</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> debug_check_no_locks_freed<span class=\"token operator\">+</span><span class=\"token number\">0x210</span><span class=\"token operator\">/</span><span class=\"token number\">0x210</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.011065</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> debug_check_no_locks_freed<span class=\"token operator\">+</span><span class=\"token number\">0x210</span><span class=\"token operator\">/</span><span class=\"token number\">0x210</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.012342</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> find_held_lock<span class=\"token operator\">+</span><span class=\"token number\">0x33</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.013289</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.014098</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> kmem_cache_free<span class=\"token operator\">+</span><span class=\"token number\">0x152</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.014998</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __kasan_slab_free<span class=\"token operator\">+</span><span class=\"token number\">0x12c</span><span class=\"token operator\">/</span><span class=\"token number\">0x170</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.015695</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_process_callbacks<span class=\"token operator\">+</span><span class=\"token number\">0x814</span><span class=\"token operator\">/</span><span class=\"token number\">0x1dc0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.016483</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> kmem_cache_free<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.017174</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> get_object<span class=\"token operator\">+</span><span class=\"token number\">0x80</span><span class=\"token operator\">/</span><span class=\"token number\">0x80</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.018026</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_process_callbacks<span class=\"token operator\">+</span><span class=\"token number\">0x814</span><span class=\"token operator\">/</span><span class=\"token number\">0x1dc0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.018974</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> note_gp_changes<span class=\"token operator\">+</span><span class=\"token number\">0x1e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x1e0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.019836</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __do_softirq<span class=\"token operator\">+</span><span class=\"token number\">0x213</span><span class=\"token operator\">/</span><span class=\"token number\">0x915</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.020656</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> irq_exit<span class=\"token operator\">+</span><span class=\"token number\">0x1a2</span><span class=\"token operator\">/</span><span class=\"token number\">0x1d0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.021375</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> smp_apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0xf1</span><span class=\"token operator\">/</span><span class=\"token number\">0x500</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.022346</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0xf</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.023225</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>IRQ<span class=\"token operator\">></span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.023716</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __memset<span class=\"token operator\">+</span><span class=\"token number\">0x29</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.024397</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> debug_check_no_locks_freed<span class=\"token operator\">+</span><span class=\"token number\">0x210</span><span class=\"token operator\">/</span><span class=\"token number\">0x210</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.025396</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> kasan_unpoison_shadow<span class=\"token operator\">+</span><span class=\"token number\">0x30</span><span class=\"token operator\">/</span><span class=\"token number\">0x40</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.026288</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> crypto_shash_update<span class=\"token operator\">+</span><span class=\"token number\">0x24d</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.027278</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_inode_csum<span class=\"token punctuation\">.</span>isra<span class=\"token punctuation\">.</span><span class=\"token number\">60</span><span class=\"token operator\">+</span><span class=\"token number\">0x2f1</span><span class=\"token operator\">/</span><span class=\"token number\">0x8f0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.028043</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_journalled_zero_new_buffers<span class=\"token operator\">+</span><span class=\"token number\">0x410</span><span class=\"token operator\">/</span><span class=\"token number\">0x410</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.028987</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> from_kprojid<span class=\"token operator\">+</span><span class=\"token number\">0x89</span><span class=\"token operator\">/</span><span class=\"token number\">0xc0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.029601</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_inode_csum_set<span class=\"token operator\">+</span><span class=\"token number\">0x1ad</span><span class=\"token operator\">/</span><span class=\"token number\">0x3c0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.030653</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_mark_iloc_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x1616</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a50</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.031704</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_chunk_trans_blocks<span class=\"token operator\">+</span><span class=\"token number\">0x20</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.032557</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __ext4_journal_get_write_access<span class=\"token operator\">+</span><span class=\"token number\">0x143</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.033437</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_mark_inode_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x204</span><span class=\"token operator\">/</span><span class=\"token number\">0x890</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.034234</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_rmdir<span class=\"token operator\">+</span><span class=\"token number\">0x7e2</span><span class=\"token operator\">/</span><span class=\"token number\">0xc10</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.035128</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_expand_extra_isize<span class=\"token operator\">+</span><span class=\"token number\">0x500</span><span class=\"token operator\">/</span><span class=\"token number\">0x500</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.035921</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.036648</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> timespec_trunc<span class=\"token operator\">+</span><span class=\"token number\">0xea</span><span class=\"token operator\">/</span><span class=\"token number\">0x180</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.037294</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> current_kernel_time64<span class=\"token operator\">+</span><span class=\"token number\">0x120</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.038016</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_rmdir<span class=\"token operator\">+</span><span class=\"token number\">0x7e2</span><span class=\"token operator\">/</span><span class=\"token number\">0xc10</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.038616</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_rename2<span class=\"token operator\">+</span><span class=\"token number\">0x210</span><span class=\"token operator\">/</span><span class=\"token number\">0x210</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.039262</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> vfs_rmdir<span class=\"token operator\">+</span><span class=\"token number\">0x24c</span><span class=\"token operator\">/</span><span class=\"token number\">0x470</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.039917</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_rmdir<span class=\"token operator\">+</span><span class=\"token number\">0x364</span><span class=\"token operator\">/</span><span class=\"token number\">0x420</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.040687</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> user_path_create<span class=\"token operator\">+</span><span class=\"token number\">0x40</span><span class=\"token operator\">/</span><span class=\"token number\">0x40</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.041628</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _raw_spin_unlock_irq<span class=\"token operator\">+</span><span class=\"token number\">0x24</span><span class=\"token operator\">/</span><span class=\"token number\">0x40</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.042456</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _raw_spin_unlock_irq<span class=\"token operator\">+</span><span class=\"token number\">0x24</span><span class=\"token operator\">/</span><span class=\"token number\">0x40</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.043311</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> task_work_run<span class=\"token operator\">+</span><span class=\"token number\">0x113</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.044071</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_syscall_64<span class=\"token operator\">+</span><span class=\"token number\">0x43</span><span class=\"token operator\">/</span><span class=\"token number\">0x6b0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.044841</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> SyS_mkdir<span class=\"token operator\">+</span><span class=\"token number\">0x260</span><span class=\"token operator\">/</span><span class=\"token number\">0x260</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.045598</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_syscall_64<span class=\"token operator\">+</span><span class=\"token number\">0x1b7</span><span class=\"token operator\">/</span><span class=\"token number\">0x6b0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.046418</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> entry_SYSCALL_64_after_hwframe<span class=\"token operator\">+</span><span class=\"token number\">0x42</span><span class=\"token operator\">/</span><span class=\"token number\">0xb7</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.047648</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.047971</span><span class=\"token punctuation\">]</span> The buggy address belongs to the page<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.048763</span><span class=\"token punctuation\">]</span> page<span class=\"token operator\">:</span>ffffea00016a61c0 count<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapcount<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapping<span class=\"token operator\">:</span><span class=\"token number\">0000000000000000</span> index<span class=\"token operator\">:</span><span class=\"token number\">0x0</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.050054</span><span class=\"token punctuation\">]</span> flags<span class=\"token operator\">:</span> <span class=\"token number\">0x100000000000000</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.050648</span><span class=\"token punctuation\">]</span> raw<span class=\"token operator\">:</span> <span class=\"token number\">0100000000000000</span> <span class=\"token number\">0000000000000000</span> <span class=\"token number\">0000000000000000</span> <span class=\"token number\">00000000ffff</span>ffff\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.051948</span><span class=\"token punctuation\">]</span> raw<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> ffffea00016a61e0 <span class=\"token number\">0000000000000000</span> <span class=\"token number\">0000000000000000</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.053383</span><span class=\"token punctuation\">]</span> page dumped because<span class=\"token operator\">:</span> kasan<span class=\"token operator\">:</span> bad access detected\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.054483</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.054732</span><span class=\"token punctuation\">]</span> Memory state around the buggy address<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.055513</span><span class=\"token punctuation\">]</span>  ffff88005a987780<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.056689</span><span class=\"token punctuation\">]</span>  ffff88005a987800<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.058088</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">></span>ffff88005a987880<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> cb cb cb cb <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.059202</span><span class=\"token punctuation\">]</span>                                            <span class=\"token operator\">^</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.060069</span><span class=\"token punctuation\">]</span>  ffff88005a987900<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.061549</span><span class=\"token punctuation\">]</span>  ffff88005a987980<span class=\"token operator\">:</span> <span class=\"token number\">00</span> f1 f1 f1 f1 <span class=\"token number\">02</span> f2 f2 f2 f2 f2 f2 f2 <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.062649</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">164.063841</span><span class=\"token punctuation\">]</span> Disabling lock debugging due to kernel taint\n\nMessage from syslogd@zer0day at Mar  <span class=\"token number\">3</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">44</span><span class=\"token operator\">:</span><span class=\"token number\">33</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n kernel<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>  <span class=\"token number\">164.048763</span><span class=\"token punctuation\">]</span> page<span class=\"token operator\">:</span>ffffea00016a61c0 count<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapcount<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapping<span class=\"token operator\">:</span><span class=\"token number\">0000000000000000</span> index<span class=\"token operator\">:</span><span class=\"token number\">0x0</span>\n\nMessage from syslogd@zer0day at Mar  <span class=\"token number\">3</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">44</span><span class=\"token operator\">:</span><span class=\"token number\">33</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n kernel<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>  <span class=\"token number\">164.050054</span><span class=\"token punctuation\">]</span> flags<span class=\"token operator\">:</span> <span class=\"token number\">0x100000000000000</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"poc-2\" style=\"position:relative;\"><a href=\"#poc-2\" aria-label=\"poc 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PoC</h3>\n<p>Here's reproducible PoC code generated by syzkaller.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_GNU_SOURCE</span> </span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;endian.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/syscall.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;signal.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/time.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/wait.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;time.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/prctl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;dirent.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/mount.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;arpa/inet.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;fcntl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/if.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/if_ether.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/if_tun.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/ip.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/tcp.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;net/if_arp.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdbool.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/ioctl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/stat.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/uio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/net.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;netinet/in.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/socket.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;fcntl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/ioctl.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/stat.h></span></span>\n\n<span class=\"token keyword\">__attribute__</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>noreturn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> status<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">volatile</span> <span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_exit_group<span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdint.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;errno.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdarg.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;sys/stat.h></span></span>\n\n<span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> kFailStatus <span class=\"token operator\">=</span> <span class=\"token number\">67</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> kRetryStatus <span class=\"token operator\">=</span> <span class=\"token number\">69</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> msg<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> e <span class=\"token operator\">=</span> errno<span class=\"token punctuation\">;</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vfprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" (errno %d)\\n\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">==</span> ENOMEM <span class=\"token operator\">||</span> e <span class=\"token operator\">==</span> EAGAIN<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> kRetryStatus <span class=\"token operator\">:</span> kFailStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> msg<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> e <span class=\"token operator\">=</span> errno<span class=\"token punctuation\">;</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vfprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" (errno %d)\\n\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span>kRetryStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token class-name\">uint64_t</span> <span class=\"token function\">current_time_ms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">timespec</span> ts<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">clock_gettime</span><span class=\"token punctuation\">(</span>CLOCK_MONOTONIC<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>ts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"clock_gettime failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token punctuation\">)</span>ts<span class=\"token punctuation\">.</span>tv_sec <span class=\"token operator\">*</span> <span class=\"token number\">1000</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token punctuation\">)</span>ts<span class=\"token punctuation\">.</span>tv_nsec <span class=\"token operator\">/</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">use_temporary_dir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> tmpdir_template<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"./syzkaller.XXXXXX\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span><span class=\"token operator\">*</span> tmpdir <span class=\"token operator\">=</span> <span class=\"token function\">mkdtemp</span><span class=\"token punctuation\">(</span>tmpdir_template<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>tmpdir<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to mkdtemp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chmod</span><span class=\"token punctuation\">(</span>tmpdir<span class=\"token punctuation\">,</span> <span class=\"token number\">0777</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chmod\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span>tmpdir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">vsnprintf_check</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span> str<span class=\"token punctuation\">,</span> <span class=\"token class-name\">size_t</span> size<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> format<span class=\"token punctuation\">,</span> va_list args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> rv<span class=\"token punctuation\">;</span>\n\n\trv <span class=\"token operator\">=</span> <span class=\"token function\">vsnprintf</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rv <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: snprintf failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">size_t</span><span class=\"token punctuation\">)</span>rv <span class=\"token operator\">>=</span> size<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: string '%s...' doesn't fit into buffer\"</span><span class=\"token punctuation\">,</span> str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">snprintf_check</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span> str<span class=\"token punctuation\">,</span> <span class=\"token class-name\">size_t</span> size<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> format<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vsnprintf_check</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">COMMAND_MAX_LEN</span> <span class=\"token expression\"><span class=\"token number\">128</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">PATH_PREFIX</span> <span class=\"token string\">\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">PATH_PREFIX_LEN</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>PATH_PREFIX<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span>bool panic<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> format<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tva_list args<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> command<span class=\"token punctuation\">[</span>PATH_PREFIX_LEN <span class=\"token operator\">+</span> COMMAND_MAX_LEN<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> rv<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">va_start</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">,</span> PATH_PREFIX<span class=\"token punctuation\">,</span> PATH_PREFIX_LEN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">vsnprintf_check</span><span class=\"token punctuation\">(</span>command <span class=\"token operator\">+</span> PATH_PREFIX_LEN<span class=\"token punctuation\">,</span> COMMAND_MAX_LEN<span class=\"token punctuation\">,</span> format<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\trv <span class=\"token operator\">=</span> <span class=\"token function\">system</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>panic <span class=\"token operator\">&amp;&amp;</span> rv <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: command \\\"%s\\\" failed with code %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>command<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> rv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">va_end</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> tunfd <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> tun_frags_enabled<span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SYZ_TUN_MAX_PACKET_SIZE</span> <span class=\"token expression\"><span class=\"token number\">1000</span></span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">TUN_IFACE</span> <span class=\"token string\">\"syz_tun\"</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">LOCAL_MAC</span> <span class=\"token string\">\"aa:aa:aa:aa:aa:aa\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">REMOTE_MAC</span> <span class=\"token string\">\"aa:aa:aa:aa:aa:bb\"</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">LOCAL_IPV4</span> <span class=\"token string\">\"172.20.20.170\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">REMOTE_IPV4</span> <span class=\"token string\">\"172.20.20.187\"</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">LOCAL_IPV6</span> <span class=\"token string\">\"fe80::aa\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">REMOTE_IPV6</span> <span class=\"token string\">\"fe80::bb\"</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IFF_NAPI</span> <span class=\"token expression\"><span class=\"token number\">0x0010</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IFF_NAPI_FRAGS</span> <span class=\"token expression\"><span class=\"token number\">0x0020</span></span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize_tun</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\ttunfd <span class=\"token operator\">=</span> <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dev/net/tun\"</span><span class=\"token punctuation\">,</span> O_RDWR <span class=\"token operator\">|</span> O_NONBLOCK<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tunfd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: can't open /dev/net/tun: please enable CONFIG_TUN=y\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"otherwise fuzzing or reproducing might not work as intended\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">int</span> kTunFd <span class=\"token operator\">=</span> <span class=\"token number\">252</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">dup2</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> kTunFd<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dup2(tunfd, kTunFd) failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ttunfd <span class=\"token operator\">=</span> kTunFd<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ifreq</span> ifr<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ifr<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ifr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">strncpy</span><span class=\"token punctuation\">(</span>ifr<span class=\"token punctuation\">.</span>ifr_name<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">,</span> IFNAMSIZ<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tifr<span class=\"token punctuation\">.</span>ifr_flags <span class=\"token operator\">=</span> IFF_TAP <span class=\"token operator\">|</span> IFF_NO_PI <span class=\"token operator\">|</span> IFF_NAPI <span class=\"token operator\">|</span> IFF_NAPI_FRAGS<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ioctl</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> TUNSETIFF<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>ifr<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tifr<span class=\"token punctuation\">.</span>ifr_flags <span class=\"token operator\">=</span> IFF_TAP <span class=\"token operator\">|</span> IFF_NO_PI<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ioctl</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> TUNSETIFF<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>ifr<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: ioctl(TUNSETIFF) failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ioctl</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> TUNGETIFF<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>ifr<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: ioctl(TUNGETIFF) failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ttun_frags_enabled <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ifr<span class=\"token punctuation\">.</span>ifr_flags <span class=\"token operator\">&amp;</span> IFF_NAPI_FRAGS<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sysctl -w net.ipv6.conf.%s.accept_dad=0\"</span><span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sysctl -w net.ipv6.conf.%s.router_solicitations=0\"</span><span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link set dev %s address %s\"</span><span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">,</span> LOCAL_MAC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip addr add %s/24 dev %s\"</span><span class=\"token punctuation\">,</span> LOCAL_IPV4<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip -6 addr add %s/120 dev %s\"</span><span class=\"token punctuation\">,</span> LOCAL_IPV6<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip neigh add %s lladdr %s dev %s nud permanent\"</span><span class=\"token punctuation\">,</span>\n\t\t\tREMOTE_IPV4<span class=\"token punctuation\">,</span> REMOTE_MAC<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip -6 neigh add %s lladdr %s dev %s nud permanent\"</span><span class=\"token punctuation\">,</span>\n\t\t\tREMOTE_IPV6<span class=\"token punctuation\">,</span> REMOTE_MAC<span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link set dev %s up\"</span><span class=\"token punctuation\">,</span> TUN_IFACE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DEV_IPV4</span> <span class=\"token string\">\"172.20.20.%d\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DEV_IPV6</span> <span class=\"token string\">\"fe80::%02hx\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">DEV_MAC</span> <span class=\"token string\">\"aa:aa:aa:aa:aa:%02hx\"</span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize_netdevices</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> devtypes<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"ip6gretap\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bridge\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"vcan\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bond\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"veth\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> devnames<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"lo\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"sit0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bridge0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"vcan0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"tunl0\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t  <span class=\"token string\">\"gre0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"gretap0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip_vti0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip6_vti0\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t  <span class=\"token string\">\"ip6tnl0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip6gre0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip6gretap0\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t  <span class=\"token string\">\"erspan0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bond0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"veth0\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"veth1\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>devtypes<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>devtypes<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link add dev %s0 type %s\"</span><span class=\"token punctuation\">,</span> devtypes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> devtypes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link add dev veth1 type veth\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>devnames<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>devnames<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">char</span> addr<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">snprintf_check</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> DEV_IPV4<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip -4 addr add %s/24 dev %s\"</span><span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">,</span> devnames<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">snprintf_check</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> DEV_IPV6<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip -6 addr add %s/120 dev %s\"</span><span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">,</span> devnames<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">snprintf_check</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> DEV_MAC<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link set dev %s address %s\"</span><span class=\"token punctuation\">,</span> devnames<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">execute_command</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ip link set dev %s up\"</span><span class=\"token punctuation\">,</span> devnames<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">read_tun</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span> data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tunfd <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">int</span> rv <span class=\"token operator\">=</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span>tunfd<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rv <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EAGAIN<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EBADFD<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tun: read failed with %d\"</span><span class=\"token punctuation\">,</span> rv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> rv<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">flush_tun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> data<span class=\"token punctuation\">[</span>SYZ_TUN_MAX_PACKET_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">read_tun</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token class-name\">uintptr_t</span> <span class=\"token function\">syz_open_pts</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uintptr_t</span> a0<span class=\"token punctuation\">,</span> <span class=\"token class-name\">uintptr_t</span> a1<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> ptyno <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">ioctl</span><span class=\"token punctuation\">(</span>a0<span class=\"token punctuation\">,</span> TIOCGPTN<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>ptyno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> buf<span class=\"token punctuation\">[</span><span class=\"token number\">128</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/dev/pts/%d\"</span><span class=\"token punctuation\">,</span> ptyno<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">open</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> a1<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">XT_TABLE_SIZE</span> <span class=\"token expression\"><span class=\"token number\">1536</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">XT_MAX_ENTRIES</span> <span class=\"token expression\"><span class=\"token number\">10</span></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">uint64_t</span> pcnt<span class=\"token punctuation\">,</span> bcnt<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_getinfo</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_get_entries</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_replace</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span><span class=\"token operator\">*</span> counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_replace</span> replace<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span> ipv4_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nat\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"mangle\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"raw\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"security\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span> ipv6_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nat\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"mangle\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"raw\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"security\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_BASE_CTL</span> <span class=\"token expression\"><span class=\"token number\">64</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_SO_SET_REPLACE</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>IPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_SO_GET_INFO</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>IPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">IPT_SO_GET_ENTRIES</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>IPT_BASE_CTL <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_getinfo</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_get_entries</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_replace</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> valid_hooks<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> hook_entry<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> underflow<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> num_counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span><span class=\"token operator\">*</span> counters<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_replace</span> replace<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span> arpt_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_BASE_CTL</span> <span class=\"token expression\"><span class=\"token number\">96</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_SO_SET_REPLACE</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>ARPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_SO_GET_INFO</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>ARPT_BASE_CTL<span class=\"token punctuation\">)</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">ARPT_SO_GET_ENTRIES</span> <span class=\"token expression\"><span class=\"token punctuation\">(</span>ARPT_BASE_CTL <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></span></span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_iptables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> family<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> level<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>family<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(%d, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">,</span> family<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> num_tables<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>errno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">case</span> EPERM<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOENT<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOPROTOOPT<span class=\"token operator\">:</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table size is too large: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">></span> XT_MAX_ENTRIES<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"too many counters: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_iptables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> num_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> family<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> level<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span> counters<span class=\"token punctuation\">[</span>XT_MAX_ENTRIES<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>family<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(%d, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">,</span> family<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> num_tables<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ipt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> entries<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(IPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>counters <span class=\"token operator\">=</span> counters<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">,</span> IPT_SO_SET_REPLACE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setsockopt(IPT_SO_SET_REPLACE)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_arptables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>arpt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>errno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">case</span> EPERM<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOENT<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOPROTOOPT<span class=\"token operator\">:</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table size is too large: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">></span> XT_MAX_ENTRIES<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"too many counters: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_entries <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>underflow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_arptables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">xt_counters</span> counters<span class=\"token punctuation\">[</span>XT_MAX_ENTRIES<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_get_entries</span> entries<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_getinfo</span> info<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>arpt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">arpt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>arpt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tentries<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> entries<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>entries<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(ARPT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> entries<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>info<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>num_entries<span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>counters <span class=\"token operator\">=</span> counters<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entrytable<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> ARPT_SO_SET_REPLACE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setsockopt(ARPT_SO_SET_REPLACE)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/if.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;linux/netfilter_bridge/ebtables.h></span></span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> name<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_replace</span> replace<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span> ebt_tables<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"filter\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nat\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"broute\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>ebt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_INIT_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>errno<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">case</span> EPERM<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOENT<span class=\"token operator\">:</span>\n\t\t\t<span class=\"token keyword\">case</span> ENOPROTOOPT<span class=\"token operator\">:</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_INIT_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size <span class=\"token operator\">></span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table size is too large: %u\"</span><span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries <span class=\"token operator\">=</span> table<span class=\"token operator\">-></span>entrytable<span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_INIT_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_INIT_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_replace</span> replace<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> entrytable<span class=\"token punctuation\">[</span>XT_TABLE_SIZE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">socklen_t</span> optlen<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">;</span>\n\n\tfd <span class=\"token operator\">=</span> <span class=\"token function\">socket</span><span class=\"token punctuation\">(</span>AF_INET<span class=\"token punctuation\">,</span> SOCK_STREAM<span class=\"token punctuation\">,</span> IPPROTO_TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ebt_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_table_desc</span><span class=\"token operator\">*</span> table <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>ebt_tables<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">strcpy</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> table<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_INFO<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_INFO)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\treplace<span class=\"token punctuation\">.</span>num_counters <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>h <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> h <span class=\"token operator\">&lt;</span> NF_BR_NUMHOOKS<span class=\"token punctuation\">;</span> h<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">[</span>h<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>entrytable<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>entrytable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\treplace<span class=\"token punctuation\">.</span>entries <span class=\"token operator\">=</span> entrytable<span class=\"token punctuation\">;</span>\n\t\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_GET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>replace<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getsockopt(EBT_SO_GET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>entrytable<span class=\"token punctuation\">,</span> entrytable<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> h <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> h <span class=\"token operator\">&lt;</span> NF_BR_NUMHOOKS<span class=\"token punctuation\">;</span> h<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>valid_hooks <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">&lt;&lt;</span> h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\ttable<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>hook_entry<span class=\"token punctuation\">[</span>h<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">struct</span> <span class=\"token class-name\">ebt_entries</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>table<span class=\"token operator\">-></span>entrytable <span class=\"token operator\">+</span> j<span class=\"token punctuation\">;</span>\n\t\t\t\tj<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\toptlen <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">.</span>entries_size<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">setsockopt</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">,</span> EBT_SO_SET_ENTRIES<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>table<span class=\"token operator\">-></span>replace<span class=\"token punctuation\">,</span> optlen<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"setsockopt(EBT_SO_SET_ENTRIES)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">checkpoint_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">checkpoint_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_arptables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_iptables</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_iptables</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET6<span class=\"token punctuation\">,</span> SOL_IPV6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">reset_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">reset_ebtables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">reset_arptables</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">reset_iptables</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv4_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET<span class=\"token punctuation\">,</span> SOL_IP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">reset_iptables</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ipv6_tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AF_INET6<span class=\"token punctuation\">,</span> SOL_IPV6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">remove_dir</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> dir<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tDIR<span class=\"token operator\">*</span> dp<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">dirent</span><span class=\"token operator\">*</span> ep<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> iter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nretry<span class=\"token operator\">:</span>\n\tdp <span class=\"token operator\">=</span> <span class=\"token function\">opendir</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dp <span class=\"token operator\">==</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EMFILE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opendir(%s) failed due to NOFILE, exiting\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"opendir(%s) failed\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ep <span class=\"token operator\">=</span> <span class=\"token function\">readdir</span><span class=\"token punctuation\">(</span>dp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">strcmp</span><span class=\"token punctuation\">(</span>ep<span class=\"token operator\">-></span>d_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> <span class=\"token function\">strcmp</span><span class=\"token punctuation\">(</span>ep<span class=\"token operator\">-></span>d_name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"..\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">char</span> filename<span class=\"token punctuation\">[</span>FILENAME_MAX<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">snprintf</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"%s/%s\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">,</span> ep<span class=\"token operator\">-></span>d_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">struct</span> <span class=\"token class-name\">stat</span> st<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">lstat</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>st<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lstat(%s) failed\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">S_ISDIR</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">.</span>st_mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">remove_dir</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EROFS<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">!=</span> EBUSY <span class=\"token operator\">||</span> i <span class=\"token operator\">></span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unlink(%s) failed\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">umount2</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> MNT_DETACH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"umount(%s) failed\"</span><span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">closedir</span><span class=\"token punctuation\">(</span>dp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">int</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">rmdir</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EROFS<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> EBUSY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">umount2</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">,</span> MNT_DETACH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"umount(%s) failed\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errno <span class=\"token operator\">==</span> ENOTEMPTY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>iter <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\titer<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t<span class=\"token keyword\">goto</span> retry<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">exitf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rmdir(%s) failed\"</span><span class=\"token punctuation\">,</span> dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">int</span> iter<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">checkpoint_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>iter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> iter<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">char</span> cwdbuf<span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">sprintf</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">,</span> <span class=\"token string\">\"./%d\"</span><span class=\"token punctuation\">,</span> iter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">,</span> <span class=\"token number\">0777</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to mkdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">int</span> pid <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"loop fork failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">prctl</span><span class=\"token punctuation\">(</span>PR_SET_PDEATHSIG<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">setpgrp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">flush_tun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">doexit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">int</span> status <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">uint64_t</span> start <span class=\"token operator\">=</span> <span class=\"token function\">current_time_ms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">int</span> res <span class=\"token operator\">=</span> <span class=\"token function\">waitpid</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">,</span> __WALL <span class=\"token operator\">|</span> WNOHANG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">==</span> pid<span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">usleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">current_time_ms</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start <span class=\"token operator\">></span> <span class=\"token number\">5</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">kill</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>pid<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">kill</span><span class=\"token punctuation\">(</span>pid<span class=\"token punctuation\">,</span> SIGKILL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">waitpid</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">,</span> __WALL<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> pid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">remove_dir</span><span class=\"token punctuation\">(</span>cwdbuf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">reset_net_namespace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">uint64_t</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xffffffffffffffff</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">long</span> res<span class=\"token punctuation\">;</span><span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000280</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/dev/loop-control\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_openat<span class=\"token punctuation\">,</span> <span class=\"token number\">0xffffffffffffff9c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000280</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x4000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000180</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000188</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000190</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000198</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_timer_settime<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000180</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000500</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x77359400</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000508</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000510</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint64_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000518</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x989680</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_timer_settime<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000540</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tres <span class=\"token operator\">=</span> <span class=\"token function\">syz_open_pts</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x42100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\tr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_ioctl<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x5462</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000140</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_ioctl<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x80084504</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x200002c0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tres <span class=\"token operator\">=</span> <span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_pipe2<span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint32_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000000</span><span class=\"token punctuation\">;</span>\n\t\tr<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint32_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000004</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint16_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000040</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint16_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000042</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x200</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint16_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000044</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x8000</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint16_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000046</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x3f</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint16_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000048</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x22</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint16_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x2000004a</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x45f</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_ioctl<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x560a</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000040</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_fstatfs<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x200000c0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syz_open_pts</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint32_t</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20000340</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x10</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_accept<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000300</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000340</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_fcntl<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x40400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">syscall</span><span class=\"token punctuation\">(</span>__NR_mmap<span class=\"token punctuation\">,</span> <span class=\"token number\">0x20000000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1000000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x32</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>cwd <span class=\"token operator\">=</span> <span class=\"token function\">get_current_dir_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span>cwd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to chdir\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">use_temporary_dir</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">initialize_tun</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">initialize_netdevices</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"default_idle---soft-lockup\" style=\"position:relative;\"><a href=\"#default_idle---soft-lockup\" aria-label=\"default_idle   soft lockup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>default_idle - soft lockup</h2>\n<p>It just halted during booting.</p>\n<h3 id=\"call-trace-dump-3\" style=\"position:relative;\"><a href=\"#call-trace-dump-3\" aria-label=\"call trace dump 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Call Trace (Dump)</h3>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">watchdog<span class=\"token operator\">:</span> BUG<span class=\"token operator\">:</span> soft lockup <span class=\"token operator\">-</span> CPU#<span class=\"token number\">0</span> stuck <span class=\"token keyword\">for</span> <span class=\"token number\">153</span>s<span class=\"token operator\">!</span> <span class=\"token punctuation\">[</span>swapper<span class=\"token operator\">/</span><span class=\"token number\">0</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\nModules linked in<span class=\"token operator\">:</span>\nirq event stamp<span class=\"token operator\">:</span> <span class=\"token number\">5914346</span>\nhardirqs last  enabled <span class=\"token function\">at</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5914343</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">0000000098680</span>cd3<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> default_idle<span class=\"token operator\">+</span><span class=\"token number\">0x18</span><span class=\"token operator\">/</span><span class=\"token number\">0x2c0</span> arch<span class=\"token operator\">/</span>x86<span class=\"token operator\">/</span>kernel<span class=\"token operator\">/</span>process<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">354</span>\nhardirqs last disabled <span class=\"token function\">at</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5914344</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000</span>d4f96a97<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> interrupt_entry<span class=\"token operator\">+</span><span class=\"token number\">0xc0</span><span class=\"token operator\">/</span><span class=\"token number\">0xe0</span> arch<span class=\"token operator\">/</span>x86<span class=\"token operator\">/</span>entry<span class=\"token operator\">/</span>entry_64<span class=\"token punctuation\">.</span>S<span class=\"token operator\">:</span><span class=\"token number\">619</span>\nsoftirqs last  enabled <span class=\"token function\">at</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5914346</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">000000000</span>af1e516<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> irq_enter<span class=\"token operator\">+</span><span class=\"token number\">0xb6</span><span class=\"token operator\">/</span><span class=\"token number\">0xd0</span> kernel<span class=\"token operator\">/</span>softirq<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">347</span>\nsoftirqs last disabled <span class=\"token function\">at</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5914345</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span><span class=\"token number\">00000000</span>b393087c<span class=\"token operator\">></span><span class=\"token punctuation\">]</span> irq_enter<span class=\"token operator\">+</span><span class=\"token number\">0x9b</span><span class=\"token operator\">/</span><span class=\"token number\">0xd0</span> kernel<span class=\"token operator\">/</span>softirq<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">351</span>\nCPU<span class=\"token operator\">:</span> <span class=\"token number\">0</span> PID<span class=\"token operator\">:</span> <span class=\"token number\">0</span> Comm<span class=\"token operator\">:</span> swapper<span class=\"token operator\">/</span><span class=\"token number\">0</span> Not tainted <span class=\"token number\">4.16</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc3<span class=\"token operator\">+</span> #<span class=\"token number\">4</span>\nHardware name<span class=\"token operator\">:</span> QEMU Standard <span class=\"token function\">PC</span> <span class=\"token punctuation\">(</span>i440FX <span class=\"token operator\">+</span> PIIX<span class=\"token punctuation\">,</span> <span class=\"token number\">1996</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BIOS <span class=\"token number\">1.10</span><span class=\"token number\">.2</span><span class=\"token operator\">-</span><span class=\"token number\">1u</span>buntu1 <span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">01</span><span class=\"token operator\">/</span><span class=\"token number\">2014</span>\nRIP<span class=\"token operator\">:</span> <span class=\"token number\">0010</span><span class=\"token operator\">:</span>native_safe_halt<span class=\"token operator\">+</span><span class=\"token number\">0x2</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span> arch<span class=\"token operator\">/</span>x86<span class=\"token operator\">/</span>include<span class=\"token operator\">/</span><span class=\"token keyword\">asm</span><span class=\"token operator\">/</span>irqflags<span class=\"token punctuation\">.</span>h<span class=\"token operator\">:</span><span class=\"token number\">54</span>\nRSP<span class=\"token operator\">:</span> <span class=\"token number\">0018</span><span class=\"token operator\">:</span>ffffffffa3607d88 EFLAGS<span class=\"token operator\">:</span> <span class=\"token number\">00000246</span> ORIG_RAX<span class=\"token operator\">:</span> ffffffffffffff12\nRAX<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000007</span> RBX<span class=\"token operator\">:</span> dffffc0000000000 RCX<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span>\nRDX<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> RSI<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000001</span> RDI<span class=\"token operator\">:</span> ffffffffa362bdec\nRBP<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> R08<span class=\"token operator\">:</span> ffffffffa362b580 R09<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span>\nR10<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> R11<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> R12<span class=\"token operator\">:</span> ffffffffa3cb8ba0\nR13<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> R14<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> R15<span class=\"token operator\">:</span> ffffffffa3cb8c40\nFS<span class=\"token operator\">:</span>  <span class=\"token number\">0000000000000000</span><span class=\"token punctuation\">(</span><span class=\"token number\">0000</span><span class=\"token punctuation\">)</span> GS<span class=\"token operator\">:</span><span class=\"token function\">ffff88002e000000</span><span class=\"token punctuation\">(</span><span class=\"token number\">0000</span><span class=\"token punctuation\">)</span> knlGS<span class=\"token operator\">:</span><span class=\"token number\">0000000000000000</span>\nCS<span class=\"token operator\">:</span>  <span class=\"token number\">0010</span> DS<span class=\"token operator\">:</span> <span class=\"token number\">0000</span> ES<span class=\"token operator\">:</span> <span class=\"token number\">0000</span> CR0<span class=\"token operator\">:</span> <span class=\"token number\">0000000080050033</span>\nCR2<span class=\"token operator\">:</span> <span class=\"token number\">0000000000619570</span> CR3<span class=\"token operator\">:</span> <span class=\"token number\">000000002</span>a01e000 CR4<span class=\"token operator\">:</span> <span class=\"token number\">00000000000006f</span><span class=\"token number\">0</span>\nDR0<span class=\"token operator\">:</span> <span class=\"token number\">0000000020000100</span> DR1<span class=\"token operator\">:</span> <span class=\"token number\">0000000020000100</span> DR2<span class=\"token operator\">:</span> <span class=\"token number\">0000000020000100</span>\nDR3<span class=\"token operator\">:</span> <span class=\"token number\">0000000020000100</span> DR6<span class=\"token operator\">:</span> <span class=\"token number\">00000000fff</span>e0ff0 DR7<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000600</span>\nCall Trace<span class=\"token operator\">:</span>\n arch_safe_halt arch<span class=\"token operator\">/</span>x86<span class=\"token operator\">/</span>include<span class=\"token operator\">/</span><span class=\"token keyword\">asm</span><span class=\"token operator\">/</span>paravirt<span class=\"token punctuation\">.</span>h<span class=\"token operator\">:</span><span class=\"token number\">94</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">inline</span><span class=\"token punctuation\">]</span>\n default_idle<span class=\"token operator\">+</span><span class=\"token number\">0x1d</span><span class=\"token operator\">/</span><span class=\"token number\">0x2c0</span> arch<span class=\"token operator\">/</span>x86<span class=\"token operator\">/</span>kernel<span class=\"token operator\">/</span>process<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">354</span>\n cpuidle_idle_call kernel<span class=\"token operator\">/</span>sched<span class=\"token operator\">/</span>idle<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">156</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">inline</span><span class=\"token punctuation\">]</span>\n do_idle<span class=\"token operator\">+</span><span class=\"token number\">0x233</span><span class=\"token operator\">/</span><span class=\"token number\">0x2c0</span> kernel<span class=\"token operator\">/</span>sched<span class=\"token operator\">/</span>idle<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">246</span>\n cpu_startup_entry<span class=\"token operator\">+</span><span class=\"token number\">0xc6</span><span class=\"token operator\">/</span><span class=\"token number\">0xd0</span> kernel<span class=\"token operator\">/</span>sched<span class=\"token operator\">/</span>idle<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">351</span>\n start_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x840</span><span class=\"token operator\">/</span><span class=\"token number\">0x880</span> init<span class=\"token operator\">/</span>main<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">717</span>\n secondary_startup_64<span class=\"token operator\">+</span><span class=\"token number\">0xa5</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span> arch<span class=\"token operator\">/</span>x86<span class=\"token operator\">/</span>kernel<span class=\"token operator\">/</span>head_64<span class=\"token punctuation\">.</span>S<span class=\"token operator\">:</span><span class=\"token number\">239</span>\nCode<span class=\"token operator\">:</span> <span class=\"token number\">04</span> <span class=\"token number\">24</span> e8 <span class=\"token number\">12</span> ee ed fd <span class=\"token number\">48</span> <span class=\"token number\">8</span>b <span class=\"token number\">04</span> <span class=\"token number\">24</span> e9 d6 fe ff ff <span class=\"token number\">48</span> <span class=\"token number\">89</span> df e8 <span class=\"token number\">01</span> ee ed fd eb <span class=\"token number\">8</span>a <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> fb f4 <span class=\"token operator\">&lt;</span>c3<span class=\"token operator\">></span> <span class=\"token number\">0f</span> <span class=\"token number\">1f</span> <span class=\"token number\">00</span> <span class=\"token number\">66</span> <span class=\"token number\">2</span>e <span class=\"token number\">0f</span> <span class=\"token number\">1f</span> <span class=\"token number\">84</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> f4 c3 <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> <span class=\"token number\">90</span> </code></pre></div>\n<h3 id=\"source-code\" style=\"position:relative;\"><a href=\"#source-code\" aria-label=\"source code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source Code</h3>\n<p>Here's <code class=\"language-text\">default_idle()</code> <code class=\"language-text\">/arch/x86/kernel/process.c</code> in <em>v4.16.0-rc3</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> __cpuidle <span class=\"token function\">default_idle</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">trace_cpu_idle_rcuidle</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">smp_processor_id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">safe_halt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">trace_cpu_idle_rcuidle</span><span class=\"token punctuation\">(</span>PWR_EVENT_EXIT<span class=\"token punctuation\">,</span> <span class=\"token function\">smp_processor_id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And this is disassemble of compiled <code class=\"language-text\">vmlinux</code> with my <code class=\"language-text\">.config</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">gdb<span class=\"token operator\">-</span>peda$ pdisas default_idle\nDump of assembler code <span class=\"token keyword\">for</span> function default_idle<span class=\"token operator\">:</span>\n   <span class=\"token number\">0xffffffff821acb10</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">0</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\t    push   r12\n   <span class=\"token number\">0xffffffff821acb12</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\t    push   rbp\n   <span class=\"token number\">0xffffffff821acb13</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">3</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\t    push   rbx\n   <span class=\"token number\">0xffffffff821acb14</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">4</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\t    mov    ebp<span class=\"token punctuation\">,</span>DWORD PTR gs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0x7de62615</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0xf130</span> <span class=\"token operator\">&lt;</span>cpu_number<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb1b</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">11</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tnop    DWORD PTR <span class=\"token punctuation\">[</span>rax<span class=\"token operator\">+</span>rax<span class=\"token operator\">*</span><span class=\"token number\">1</span><span class=\"token operator\">+</span><span class=\"token number\">0x0</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">0xffffffff821acb20</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">16</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff810f2370</span> <span class=\"token operator\">&lt;</span>trace_hardirqs_on<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb25</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">21</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   QWORD PTR ds<span class=\"token operator\">:</span><span class=\"token number\">0xffffffff82c406c0</span>\n   <span class=\"token number\">0xffffffff821acb2c</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">28</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    ebp<span class=\"token punctuation\">,</span>DWORD PTR gs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0x7de625fd</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0xf130</span> <span class=\"token operator\">&lt;</span>cpu_number<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb33</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">35</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tnop    DWORD PTR <span class=\"token punctuation\">[</span>rax<span class=\"token operator\">+</span>rax<span class=\"token operator\">*</span><span class=\"token number\">1</span><span class=\"token operator\">+</span><span class=\"token number\">0x0</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">0xffffffff821acb38</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">40</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tpop    rbx\n   <span class=\"token number\">0xffffffff821acb39</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">41</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tpop    rbp\n   <span class=\"token number\">0xffffffff821acb3a</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">42</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tpop    r12\n   <span class=\"token number\">0xffffffff821acb3c</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">44</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tret    \n   <span class=\"token number\">0xffffffff821acb3d</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">45</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    eax<span class=\"token punctuation\">,</span>DWORD PTR gs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0x7de625ec</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0xf130</span> <span class=\"token operator\">&lt;</span>cpu_number<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb44</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">52</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    eax<span class=\"token punctuation\">,</span>eax\n   <span class=\"token number\">0xffffffff821acb46</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">54</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tbt     QWORD PTR <span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0xbf8b52</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>rax        # <span class=\"token number\">0xffffffff82da56a0</span> <span class=\"token operator\">&lt;</span>__cpu_online_mask<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb4e</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">62</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjae    <span class=\"token number\">0xffffffff821acb38</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">40</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb50</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">64</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff8112fef0</span> <span class=\"token operator\">&lt;</span>rcu_irq_enter_irqson<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb55</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">69</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tinc    DWORD PTR gs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0x7de682b4</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0x14e10</span> <span class=\"token operator\">&lt;</span>__preempt_count<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb5c</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">76</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rbx<span class=\"token punctuation\">,</span>QWORD PTR <span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0xbad0a5</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0xffffffff82d59c08</span> <span class=\"token operator\">&lt;</span>__tracepoint_cpu_idle<span class=\"token operator\">+</span><span class=\"token number\">40</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb63</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">83</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff81124110</span> <span class=\"token operator\">&lt;</span>debug_lockdep_rcu_enabled<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb68</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">88</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\ttest   eax<span class=\"token punctuation\">,</span>eax\n   <span class=\"token number\">0xffffffff821acb6a</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">90</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tje     <span class=\"token number\">0xffffffff821acb79</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">105</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb6c</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">92</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcmp    BYTE PTR <span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0xba8f9b</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x0</span>        # <span class=\"token number\">0xffffffff82d55b0e</span> <span class=\"token operator\">&lt;</span>__warned<span class=\"token punctuation\">.</span><span class=\"token number\">41319</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb73</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">99</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tje     <span class=\"token number\">0xffffffff821acc22</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">274</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb79</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">105</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\ttest   rbx<span class=\"token punctuation\">,</span>rbx\n   <span class=\"token number\">0xffffffff821acb7c</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">108</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tje     <span class=\"token number\">0xffffffff821acba1</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">145</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb7e</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">110</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rax<span class=\"token punctuation\">,</span>QWORD PTR <span class=\"token punctuation\">[</span>rbx<span class=\"token punctuation\">]</span>\n   <span class=\"token number\">0xffffffff821acb81</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">113</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    r12d<span class=\"token punctuation\">,</span><span class=\"token number\">0xffffffff</span>\n   <span class=\"token number\">0xffffffff821acb87</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">119</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rdi<span class=\"token punctuation\">,</span>QWORD PTR <span class=\"token punctuation\">[</span>rbx<span class=\"token operator\">+</span><span class=\"token number\">0x8</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">0xffffffff821acb8b</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">123</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tadd    rbx<span class=\"token punctuation\">,</span><span class=\"token number\">0x18</span>\n   <span class=\"token number\">0xffffffff821acb8f</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">127</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    edx<span class=\"token punctuation\">,</span>ebp\n   <span class=\"token number\">0xffffffff821acb91</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">129</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    esi<span class=\"token punctuation\">,</span>r12d\n   <span class=\"token number\">0xffffffff821acb94</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">132</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff82403000</span> <span class=\"token operator\">&lt;</span>__x86_indirect_thunk_rax<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acb99</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">137</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rax<span class=\"token punctuation\">,</span>QWORD PTR <span class=\"token punctuation\">[</span>rbx<span class=\"token punctuation\">]</span>\n   <span class=\"token number\">0xffffffff821acb9c</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">140</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\ttest   rax<span class=\"token punctuation\">,</span>rax\n   <span class=\"token number\">0xffffffff821acb9f</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">143</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjne    <span class=\"token number\">0xffffffff821acb87</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">119</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acba1</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">145</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tdec    DWORD PTR gs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0x7de68268</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0x14e10</span> <span class=\"token operator\">&lt;</span>__preempt_count<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acba8</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">152</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tpop    rbx\n   <span class=\"token number\">0xffffffff821acba9</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">153</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tpop    rbp\n   <span class=\"token number\">0xffffffff821acbaa</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">154</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tpop    r12\n   <span class=\"token number\">0xffffffff821acbac</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">156</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjmp    <span class=\"token number\">0xffffffff8112fa80</span> <span class=\"token operator\">&lt;</span>rcu_irq_exit_irqson<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbb1</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">161</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    eax<span class=\"token punctuation\">,</span>DWORD PTR gs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0x7de62578</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0xf130</span> <span class=\"token operator\">&lt;</span>cpu_number<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbb8</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">168</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    eax<span class=\"token punctuation\">,</span>eax\n   <span class=\"token number\">0xffffffff821acbba</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">170</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tbt     QWORD PTR <span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0xbf8ade</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>rax        # <span class=\"token number\">0xffffffff82da56a0</span> <span class=\"token operator\">&lt;</span>__cpu_online_mask<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbc2</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">178</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjae    <span class=\"token number\">0xffffffff821acb20</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">16</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbc8</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">184</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff8112fef0</span> <span class=\"token operator\">&lt;</span>rcu_irq_enter_irqson<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbcd</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">189</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tinc    DWORD PTR gs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0x7de6823c</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0x14e10</span> <span class=\"token operator\">&lt;</span>__preempt_count<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbd4</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">196</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rbx<span class=\"token punctuation\">,</span>QWORD PTR <span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0xbad02d</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0xffffffff82d59c08</span> <span class=\"token operator\">&lt;</span>__tracepoint_cpu_idle<span class=\"token operator\">+</span><span class=\"token number\">40</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbdb</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">203</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff81124110</span> <span class=\"token operator\">&lt;</span>debug_lockdep_rcu_enabled<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbe0</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">208</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\ttest   eax<span class=\"token punctuation\">,</span>eax\n   <span class=\"token number\">0xffffffff821acbe2</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">210</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tje     <span class=\"token number\">0xffffffff821acbed</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">221</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbe4</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">212</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcmp    BYTE PTR <span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0xba8f23</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x0</span>        # <span class=\"token number\">0xffffffff82d55b0e</span> <span class=\"token operator\">&lt;</span>__warned<span class=\"token punctuation\">.</span><span class=\"token number\">41319</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbeb</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">219</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tje     <span class=\"token number\">0xffffffff821acc53</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">323</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbed</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">221</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\ttest   rbx<span class=\"token punctuation\">,</span>rbx\n   <span class=\"token number\">0xffffffff821acbf0</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">224</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tje     <span class=\"token number\">0xffffffff821acc11</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">257</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acbf2</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">226</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rax<span class=\"token punctuation\">,</span>QWORD PTR <span class=\"token punctuation\">[</span>rbx<span class=\"token punctuation\">]</span>\n   <span class=\"token number\">0xffffffff821acbf5</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">229</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rdi<span class=\"token punctuation\">,</span>QWORD PTR <span class=\"token punctuation\">[</span>rbx<span class=\"token operator\">+</span><span class=\"token number\">0x8</span><span class=\"token punctuation\">]</span>\n   <span class=\"token number\">0xffffffff821acbf9</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">233</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tadd    rbx<span class=\"token punctuation\">,</span><span class=\"token number\">0x18</span>\n   <span class=\"token number\">0xffffffff821acbfd</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">237</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    edx<span class=\"token punctuation\">,</span>ebp\n   <span class=\"token number\">0xffffffff821acbff</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">239</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    esi<span class=\"token punctuation\">,</span><span class=\"token number\">0x1</span>\n   <span class=\"token number\">0xffffffff821acc04</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">244</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff82403000</span> <span class=\"token operator\">&lt;</span>__x86_indirect_thunk_rax<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc09</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">249</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rax<span class=\"token punctuation\">,</span>QWORD PTR <span class=\"token punctuation\">[</span>rbx<span class=\"token punctuation\">]</span>\n   <span class=\"token number\">0xffffffff821acc0c</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">252</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\ttest   rax<span class=\"token punctuation\">,</span>rax\n   <span class=\"token number\">0xffffffff821acc0f</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">255</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjne    <span class=\"token number\">0xffffffff821acbf5</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">229</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc11</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">257</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tdec    DWORD PTR gs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0x7de681f8</span><span class=\"token punctuation\">]</span>        # <span class=\"token number\">0x14e10</span> <span class=\"token operator\">&lt;</span>__preempt_count<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc18</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">264</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff8112fa80</span> <span class=\"token operator\">&lt;</span>rcu_irq_exit_irqson<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc1d</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">269</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjmp    <span class=\"token number\">0xffffffff821acb20</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">16</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc22</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">274</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff811241a0</span> <span class=\"token operator\">&lt;</span>rcu_read_lock_sched_held<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc27</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">279</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\ttest   eax<span class=\"token punctuation\">,</span>eax\n   <span class=\"token number\">0xffffffff821acc29</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">281</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjne    <span class=\"token number\">0xffffffff821acb79</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">105</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc2f</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">287</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rdx<span class=\"token punctuation\">,</span><span class=\"token number\">0xffffffff82920580</span>\n   <span class=\"token number\">0xffffffff821acc36</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">294</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    esi<span class=\"token punctuation\">,</span><span class=\"token number\">0x28</span>\n   <span class=\"token number\">0xffffffff821acc3b</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">299</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rdi<span class=\"token punctuation\">,</span><span class=\"token number\">0xffffffff82925778</span>\n   <span class=\"token number\">0xffffffff821acc42</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">306</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    BYTE PTR <span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0xba8ec5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x1</span>        # <span class=\"token number\">0xffffffff82d55b0e</span> <span class=\"token operator\">&lt;</span>__warned<span class=\"token punctuation\">.</span><span class=\"token number\">41319</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc49</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">313</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff810f59ee</span> <span class=\"token operator\">&lt;</span>lockdep_rcu_suspicious<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc4e</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">318</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjmp    <span class=\"token number\">0xffffffff821acb79</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">105</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc53</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">323</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff811241a0</span> <span class=\"token operator\">&lt;</span>rcu_read_lock_sched_held<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc58</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">328</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\ttest   eax<span class=\"token punctuation\">,</span>eax\n   <span class=\"token number\">0xffffffff821acc5a</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">330</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjne    <span class=\"token number\">0xffffffff821acbed</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">221</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc5c</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">332</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rdx<span class=\"token punctuation\">,</span><span class=\"token number\">0xffffffff82920580</span>\n   <span class=\"token number\">0xffffffff821acc63</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">339</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    esi<span class=\"token punctuation\">,</span><span class=\"token number\">0x28</span>\n   <span class=\"token number\">0xffffffff821acc68</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">344</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    rdi<span class=\"token punctuation\">,</span><span class=\"token number\">0xffffffff82925778</span>\n   <span class=\"token number\">0xffffffff821acc6f</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">351</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tmov    BYTE PTR <span class=\"token punctuation\">[</span>rip<span class=\"token operator\">+</span><span class=\"token number\">0xba8e98</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x1</span>        # <span class=\"token number\">0xffffffff82d55b0e</span> <span class=\"token operator\">&lt;</span>__warned<span class=\"token punctuation\">.</span><span class=\"token number\">41319</span><span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc76</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">358</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tcall   <span class=\"token number\">0xffffffff810f59ee</span> <span class=\"token operator\">&lt;</span>lockdep_rcu_suspicious<span class=\"token operator\">></span>\n   <span class=\"token number\">0xffffffff821acc7b</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">+</span><span class=\"token number\">363</span><span class=\"token operator\">></span><span class=\"token operator\">:</span>\tjmp    <span class=\"token number\">0xffffffff821acbed</span> <span class=\"token operator\">&lt;</span>default_idle<span class=\"token operator\">+</span><span class=\"token number\">221</span><span class=\"token operator\">></span>\nEnd of assembler dump<span class=\"token punctuation\">.</span></code></pre></div>\n<p>Code :</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">   <span class=\"token number\">0</span><span class=\"token operator\">:</span>   <span class=\"token number\">04</span> <span class=\"token number\">24</span>                   add    al<span class=\"token punctuation\">,</span><span class=\"token number\">0x24</span>\n   <span class=\"token number\">2</span><span class=\"token operator\">:</span>   e8 <span class=\"token number\">12</span> ee ed fd          call   <span class=\"token number\">0xfffffffffdedee19</span>\n   <span class=\"token number\">7</span><span class=\"token operator\">:</span>   <span class=\"token number\">48</span> <span class=\"token number\">8</span>b <span class=\"token number\">04</span> <span class=\"token number\">24</span>             mov    rax<span class=\"token punctuation\">,</span>QWORD PTR <span class=\"token punctuation\">[</span>rsp<span class=\"token punctuation\">]</span>\n   b<span class=\"token operator\">:</span>   e9 d6 fe ff ff          jmp    <span class=\"token number\">0xfffffffffffffee6</span>\n  <span class=\"token number\">10</span><span class=\"token operator\">:</span>   <span class=\"token number\">48</span> <span class=\"token number\">89</span> df                mov    rdi<span class=\"token punctuation\">,</span>rbx\n  <span class=\"token number\">13</span><span class=\"token operator\">:</span>   e8 <span class=\"token number\">01</span> ee ed fd          call   <span class=\"token number\">0xfffffffffdedee19</span>\n  <span class=\"token number\">18</span><span class=\"token operator\">:</span>   eb <span class=\"token number\">8</span>a                   jmp    <span class=\"token number\">0xffffffffffffffa4</span>\n  <span class=\"token number\">1</span>a<span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">1</span>b<span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">1</span>c<span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">1</span>d<span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">1</span>e<span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">1f</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">20</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">21</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">22</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">23</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">24</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">25</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">26</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">27</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">28</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">29</span><span class=\"token operator\">:</span>   fb                      sti    \n  <span class=\"token number\">2</span>a<span class=\"token operator\">:</span>   f4                      hlt    \n  <span class=\"token number\">2</span>b<span class=\"token operator\">:</span>  <span class=\"token operator\">*</span>c3                      ret    \n  <span class=\"token number\">2</span>c<span class=\"token operator\">:</span>   <span class=\"token number\">0f</span> <span class=\"token number\">1f</span> <span class=\"token number\">00</span>                nop    DWORD PTR <span class=\"token punctuation\">[</span>rax<span class=\"token punctuation\">]</span>\n  <span class=\"token number\">2f</span><span class=\"token operator\">:</span>   <span class=\"token number\">66</span> <span class=\"token number\">2</span>e <span class=\"token number\">0f</span> <span class=\"token number\">1f</span> <span class=\"token number\">84</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>    nop    WORD PTR cs<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>rax<span class=\"token operator\">+</span>rax<span class=\"token operator\">*</span><span class=\"token number\">1</span><span class=\"token operator\">+</span><span class=\"token number\">0x0</span><span class=\"token punctuation\">]</span>\n  <span class=\"token number\">36</span><span class=\"token operator\">:</span>   <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> \n  <span class=\"token number\">39</span><span class=\"token operator\">:</span>   f4                      hlt    \n  <span class=\"token number\">3</span>a<span class=\"token operator\">:</span>   c3                      ret    \n  <span class=\"token number\">3</span>b<span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">3</span>c<span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">3</span>d<span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">3</span>e<span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop\n  <span class=\"token number\">3f</span><span class=\"token operator\">:</span>   <span class=\"token number\">90</span>                      nop</code></pre></div>\n<p>Maybe, in <code class=\"language-text\">safe_halt()</code>, stuck for seconds because of ...</p>\n<p><strong>End</strong></p>\n<h2 id=\"perf_exclude_event---alloca-out-of-bounds\" style=\"position:relative;\"><a href=\"#perf_exclude_event---alloca-out-of-bounds\" aria-label=\"perf_exclude_event   alloca out of bounds permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>perf_exclude_event - alloca Out Of Bounds</h2>\n<p>Got from syzkaller &#x26; Found in LK v4.16.0-rc4.</p>\n<h3 id=\"call-trace-dump-4\" style=\"position:relative;\"><a href=\"#call-trace-dump-4\" aria-label=\"call trace dump 4 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Call Trace (Dump)</h3>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">[</span>   <span class=\"token number\">45.867098</span><span class=\"token punctuation\">]</span> BUG<span class=\"token operator\">:</span> KASAN<span class=\"token operator\">:</span> alloca<span class=\"token operator\">-</span>out<span class=\"token operator\">-</span>of<span class=\"token operator\">-</span>bounds in perf_exclude_event<span class=\"token operator\">+</span><span class=\"token number\">0x17e</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span> kernel<span class=\"token operator\">/</span>events<span class=\"token operator\">/</span>core<span class=\"token punctuation\">.</span>c<span class=\"token operator\">:</span><span class=\"token number\">7521</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.867976</span><span class=\"token punctuation\">]</span> Read of size <span class=\"token number\">8</span> at addr ffff880022efeae0 by task syz<span class=\"token operator\">-</span>executor7<span class=\"token operator\">/</span><span class=\"token number\">7812</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.868795</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.869000</span><span class=\"token punctuation\">]</span> CPU<span class=\"token operator\">:</span> <span class=\"token number\">0</span> PID<span class=\"token operator\">:</span> <span class=\"token number\">7812</span> Comm<span class=\"token operator\">:</span> syz<span class=\"token operator\">-</span>executor7 Not tainted <span class=\"token number\">4.16</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc4 #<span class=\"token number\">6</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.869791</span><span class=\"token punctuation\">]</span> Hardware name<span class=\"token operator\">:</span> QEMU Standard <span class=\"token function\">PC</span> <span class=\"token punctuation\">(</span>i440FX <span class=\"token operator\">+</span> PIIX<span class=\"token punctuation\">,</span> <span class=\"token number\">1996</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BIOS <span class=\"token number\">1.10</span><span class=\"token number\">.2</span><span class=\"token operator\">-</span><span class=\"token number\">1u</span>buntu1 <span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">01</span><span class=\"token operator\">/</span><span class=\"token number\">2014</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.870801</span><span class=\"token punctuation\">]</span> Call Trace<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.871096</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">&lt;</span>IRQ<span class=\"token operator\">></span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.871352</span><span class=\"token punctuation\">]</span>  dump_stack<span class=\"token operator\">+</span><span class=\"token number\">0x127</span><span class=\"token operator\">/</span><span class=\"token number\">0x213</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.871771</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _atomic_dec_and_lock<span class=\"token operator\">+</span><span class=\"token number\">0x18d</span><span class=\"token operator\">/</span><span class=\"token number\">0x18d</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.872299</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> show_regs_print_info<span class=\"token operator\">+</span><span class=\"token number\">0x12</span><span class=\"token operator\">/</span><span class=\"token number\">0x12</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.872816</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_exclude_event<span class=\"token operator\">+</span><span class=\"token number\">0x17e</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.873337</span><span class=\"token punctuation\">]</span>  print_address_description<span class=\"token operator\">+</span><span class=\"token number\">0x60</span><span class=\"token operator\">/</span><span class=\"token number\">0x22b</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.873886</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_exclude_event<span class=\"token operator\">+</span><span class=\"token number\">0x17e</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.874407</span><span class=\"token punctuation\">]</span>  kasan_report<span class=\"token punctuation\">.</span>cold<span class=\"token punctuation\">.</span><span class=\"token number\">6</span><span class=\"token operator\">+</span><span class=\"token number\">0xac</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f4</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.874913</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_exclude_event<span class=\"token operator\">+</span><span class=\"token number\">0x17e</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.875437</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_swevent_hrtimer<span class=\"token operator\">+</span><span class=\"token number\">0x28c</span><span class=\"token operator\">/</span><span class=\"token number\">0x500</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.875970</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.876399</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> scsi_finish_command<span class=\"token operator\">+</span><span class=\"token number\">0x611</span><span class=\"token operator\">/</span><span class=\"token number\">0x810</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.876920</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_iterate_ctx<span class=\"token operator\">+</span><span class=\"token number\">0x420</span><span class=\"token operator\">/</span><span class=\"token number\">0x420</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.877439</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.877870</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_nmi_exit<span class=\"token operator\">+</span><span class=\"token number\">0x742</span><span class=\"token operator\">/</span><span class=\"token number\">0x970</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.878333</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> find_held_lock<span class=\"token operator\">+</span><span class=\"token number\">0x33</span><span class=\"token operator\">/</span><span class=\"token number\">0x1b0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.878824</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.879328</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.879918</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x4a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.880438</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.880882</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> enqueue_hrtimer<span class=\"token operator\">+</span><span class=\"token number\">0x171</span><span class=\"token operator\">/</span><span class=\"token number\">0x500</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.881373</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_raw_spin_trylock<span class=\"token operator\">+</span><span class=\"token number\">0x190</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.881920</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.882369</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __lock_is_held<span class=\"token operator\">+</span><span class=\"token number\">0xad</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.882860</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __hrtimer_run_queues<span class=\"token operator\">+</span><span class=\"token number\">0x379</span><span class=\"token operator\">/</span><span class=\"token number\">0x1000</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.883414</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_iterate_ctx<span class=\"token operator\">+</span><span class=\"token number\">0x420</span><span class=\"token operator\">/</span><span class=\"token number\">0x420</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.883907</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> hrtimer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0x10b</span><span class=\"token operator\">/</span><span class=\"token number\">0x730</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.884432</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> hrtimer_init<span class=\"token operator\">+</span><span class=\"token number\">0x430</span><span class=\"token operator\">/</span><span class=\"token number\">0x430</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.884889</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_downgrade<span class=\"token operator\">+</span><span class=\"token number\">0x6d0</span><span class=\"token operator\">/</span><span class=\"token number\">0x6d0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.885382</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_read_lock_sched_held<span class=\"token operator\">+</span><span class=\"token number\">0x102</span><span class=\"token operator\">/</span><span class=\"token number\">0x120</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.885958</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> pvclock_read_flags<span class=\"token operator\">+</span><span class=\"token number\">0x150</span><span class=\"token operator\">/</span><span class=\"token number\">0x150</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.886476</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __lock_is_held<span class=\"token operator\">+</span><span class=\"token number\">0xad</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.886952</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> kvm_clock_read<span class=\"token operator\">+</span><span class=\"token number\">0x21</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.887423</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ktime_get_update_offsets_now<span class=\"token operator\">+</span><span class=\"token number\">0x324</span><span class=\"token operator\">/</span><span class=\"token number\">0x400</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.888048</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_timer<span class=\"token operator\">+</span><span class=\"token number\">0x40</span><span class=\"token operator\">/</span><span class=\"token number\">0x40</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.888449</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.888884</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_read_lock_sched_held<span class=\"token operator\">+</span><span class=\"token number\">0x102</span><span class=\"token operator\">/</span><span class=\"token number\">0x120</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.889470</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> hpet_assign_irq<span class=\"token operator\">+</span><span class=\"token number\">0x1e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x1e0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.889991</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> hrtimer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0x2e9</span><span class=\"token operator\">/</span><span class=\"token number\">0x730</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.890512</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> smp_apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0x14d</span><span class=\"token operator\">/</span><span class=\"token number\">0x710</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.891093</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> smp_call_function_single_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0x660</span><span class=\"token operator\">/</span><span class=\"token number\">0x660</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.891778</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> handle_edge_irq<span class=\"token operator\">+</span><span class=\"token number\">0x322</span><span class=\"token operator\">/</span><span class=\"token number\">0x840</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.892270</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> task_prio<span class=\"token operator\">+</span><span class=\"token number\">0x50</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.892695</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _raw_spin_unlock<span class=\"token operator\">+</span><span class=\"token number\">0x1f</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.893172</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_off_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.893767</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0xf</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.894266</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>IRQ<span class=\"token operator\">></span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.894546</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> crypto_shash_update<span class=\"token operator\">+</span><span class=\"token number\">0x23d</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.895075</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> kasan_disable_current<span class=\"token operator\">+</span><span class=\"token number\">0x20</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.895627</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> crypto_shash_update<span class=\"token operator\">+</span><span class=\"token number\">0x24d</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.896161</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_inode_csum<span class=\"token punctuation\">.</span>isra<span class=\"token punctuation\">.</span><span class=\"token number\">59</span><span class=\"token operator\">+</span><span class=\"token number\">0x562</span><span class=\"token operator\">/</span><span class=\"token number\">0xef0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.896726</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_journalled_zero_new_buffers<span class=\"token operator\">+</span><span class=\"token number\">0x4e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4e0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.897421</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_on_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.897974</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.898434</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.898917</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_on_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.899470</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.899925</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_inode_csum_set<span class=\"token operator\">+</span><span class=\"token number\">0x17c</span><span class=\"token operator\">/</span><span class=\"token number\">0x370</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.900450</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_mark_iloc_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x1709</span><span class=\"token operator\">/</span><span class=\"token number\">0x2cc0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.901030</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_chunk_trans_blocks<span class=\"token operator\">+</span><span class=\"token number\">0x20</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.901578</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_add_journal_head<span class=\"token operator\">+</span><span class=\"token number\">0x3b0</span><span class=\"token operator\">/</span><span class=\"token number\">0x560</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.902205</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_write_access_granted<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">8</span><span class=\"token operator\">+</span><span class=\"token number\">0x264</span><span class=\"token operator\">/</span><span class=\"token number\">0x410</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.902851</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_write_metadata_buffer<span class=\"token operator\">+</span><span class=\"token number\">0xf80</span><span class=\"token operator\">/</span><span class=\"token number\">0xf80</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.903498</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_note_context_switch<span class=\"token operator\">+</span><span class=\"token number\">0x710</span><span class=\"token operator\">/</span><span class=\"token number\">0x710</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.904022</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_put_journal_head<span class=\"token operator\">+</span><span class=\"token number\">0x3b1</span><span class=\"token operator\">/</span><span class=\"token number\">0x54f</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.904594</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_get_write_access<span class=\"token operator\">+</span><span class=\"token number\">0x6b</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.905153</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __ext4_journal_get_write_access<span class=\"token operator\">+</span><span class=\"token number\">0x143</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.905795</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_mark_inode_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x220</span><span class=\"token operator\">/</span><span class=\"token number\">0xac0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.906307</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_dirty_inode<span class=\"token operator\">+</span><span class=\"token number\">0x8d</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.906776</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_expand_extra_isize<span class=\"token operator\">+</span><span class=\"token number\">0x560</span><span class=\"token operator\">/</span><span class=\"token number\">0x560</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.907316</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __lock_is_held<span class=\"token operator\">+</span><span class=\"token number\">0xad</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.907857</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_setattr<span class=\"token operator\">+</span><span class=\"token number\">0x2a90</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a90</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.908361</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __ext4_journal_start_sb<span class=\"token operator\">+</span><span class=\"token number\">0x175</span><span class=\"token operator\">/</span><span class=\"token number\">0x5d0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.908950</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_dirty_inode<span class=\"token operator\">+</span><span class=\"token number\">0x5b</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.909480</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_journal_abort_handle<span class=\"token punctuation\">.</span>isra<span class=\"token punctuation\">.</span><span class=\"token number\">4</span><span class=\"token operator\">+</span><span class=\"token number\">0x250</span><span class=\"token operator\">/</span><span class=\"token number\">0x250</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.910212</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __lock_is_held<span class=\"token operator\">+</span><span class=\"token number\">0xad</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.910774</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_setattr<span class=\"token operator\">+</span><span class=\"token number\">0x2a90</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a90</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.911330</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_dirty_inode<span class=\"token operator\">+</span><span class=\"token number\">0x8d</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.911855</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __mark_inode_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x798</span><span class=\"token operator\">/</span><span class=\"token number\">0x1570</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.912431</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> redirty_tail<span class=\"token operator\">+</span><span class=\"token number\">0x200</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.912947</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> preempt_schedule_common<span class=\"token operator\">+</span><span class=\"token number\">0x1d</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.913551</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _cond_resched<span class=\"token operator\">+</span><span class=\"token number\">0x18</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.914033</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> filemap_fault<span class=\"token operator\">+</span><span class=\"token number\">0x5bf</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.914555</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.915048</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.915536</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_on_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.916149</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.916662</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> current_kernel_time64<span class=\"token operator\">+</span><span class=\"token number\">0x189</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.917293</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> current_kernel_time64<span class=\"token operator\">+</span><span class=\"token number\">0x1a4</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.917909</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> generic_update_time<span class=\"token operator\">+</span><span class=\"token number\">0x26a</span><span class=\"token operator\">/</span><span class=\"token number\">0x430</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.918426</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> put_itimerspec64<span class=\"token operator\">+</span><span class=\"token number\">0x2f0</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.918923</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> dentry_needs_remove_privs<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">24</span><span class=\"token operator\">+</span><span class=\"token number\">0x60</span><span class=\"token operator\">/</span><span class=\"token number\">0x60</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.919546</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x1b3</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.920005</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> dentry_needs_remove_privs<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">24</span><span class=\"token operator\">+</span><span class=\"token number\">0x60</span><span class=\"token operator\">/</span><span class=\"token number\">0x60</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.920639</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> file_update_time<span class=\"token operator\">+</span><span class=\"token number\">0x383</span><span class=\"token operator\">/</span><span class=\"token number\">0x620</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.921172</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> current_time<span class=\"token operator\">+</span><span class=\"token number\">0xc0</span><span class=\"token operator\">/</span><span class=\"token number\">0xc0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.921646</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_read_lock_sched_held<span class=\"token operator\">+</span><span class=\"token number\">0x102</span><span class=\"token operator\">/</span><span class=\"token number\">0x120</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.922306</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_sync_lockdep_assert<span class=\"token operator\">+</span><span class=\"token number\">0x6f</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.922886</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __sb_start_write<span class=\"token operator\">+</span><span class=\"token number\">0x171</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.923421</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_page_mkwrite<span class=\"token operator\">+</span><span class=\"token number\">0x1db</span><span class=\"token operator\">/</span><span class=\"token number\">0x1320</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.923976</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> futex_wake<span class=\"token operator\">+</span><span class=\"token number\">0x6d0</span><span class=\"token operator\">/</span><span class=\"token number\">0x6d0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.924411</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_change_inode_journal_flag<span class=\"token operator\">+</span><span class=\"token number\">0x3f0</span><span class=\"token operator\">/</span><span class=\"token number\">0x3f0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.925015</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_filemap_fault<span class=\"token operator\">+</span><span class=\"token number\">0x75</span><span class=\"token operator\">/</span><span class=\"token number\">0xa4</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.925552</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __down_interruptible<span class=\"token operator\">+</span><span class=\"token number\">0x700</span><span class=\"token operator\">/</span><span class=\"token number\">0x700</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.926145</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_page_mkwrite<span class=\"token operator\">+</span><span class=\"token number\">0x137</span><span class=\"token operator\">/</span><span class=\"token number\">0x470</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.926673</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __do_fault<span class=\"token operator\">+</span><span class=\"token number\">0x3f0</span><span class=\"token operator\">/</span><span class=\"token number\">0x3f0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.927169</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> wake_up_page_bit<span class=\"token operator\">+</span><span class=\"token number\">0x610</span><span class=\"token operator\">/</span><span class=\"token number\">0x610</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.927745</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __handle_mm_fault<span class=\"token operator\">+</span><span class=\"token number\">0x448</span><span class=\"token operator\">/</span><span class=\"token number\">0x3940</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.928264</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __handle_mm_fault<span class=\"token operator\">+</span><span class=\"token number\">0x1e62</span><span class=\"token operator\">/</span><span class=\"token number\">0x3940</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.928808</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> vm_insert_mixed_mkwrite<span class=\"token operator\">+</span><span class=\"token number\">0x30</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.929363</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.929839</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> find_held_lock<span class=\"token operator\">+</span><span class=\"token number\">0x33</span><span class=\"token operator\">/</span><span class=\"token number\">0x1b0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.930336</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> print_usage_bug<span class=\"token operator\">+</span><span class=\"token number\">0x140</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.930820</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> exit_robust_list<span class=\"token operator\">+</span><span class=\"token number\">0x290</span><span class=\"token operator\">/</span><span class=\"token number\">0x290</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.931322</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> print_usage_bug<span class=\"token operator\">+</span><span class=\"token number\">0x140</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.931790</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> print_usage_bug<span class=\"token operator\">+</span><span class=\"token number\">0x140</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.932317</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x4a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.932748</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x4a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.933213</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> print_usage_bug<span class=\"token operator\">+</span><span class=\"token number\">0x140</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.933748</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_raw_spin_trylock<span class=\"token operator\">+</span><span class=\"token number\">0x190</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.934293</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.934742</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.935224</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> find_held_lock<span class=\"token operator\">+</span><span class=\"token number\">0x33</span><span class=\"token operator\">/</span><span class=\"token number\">0x1b0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.935695</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.936147</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.936623</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.937106</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.937611</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.938192</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.938672</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_on_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.939215</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.939611</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> handle_mm_fault<span class=\"token operator\">+</span><span class=\"token number\">0x15a</span><span class=\"token operator\">/</span><span class=\"token number\">0x410</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.940175</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __do_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x672</span><span class=\"token operator\">/</span><span class=\"token number\">0xe30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.940700</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mm_fault_error<span class=\"token operator\">+</span><span class=\"token number\">0x360</span><span class=\"token operator\">/</span><span class=\"token number\">0x360</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.941258</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> SyS_clock_settime<span class=\"token operator\">+</span><span class=\"token number\">0x230</span><span class=\"token operator\">/</span><span class=\"token number\">0x230</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.941801</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> async_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x2f</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.942153</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x720</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.942536</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __do_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0xe30</span><span class=\"token operator\">/</span><span class=\"token number\">0xe30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.942955</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> exit_to_usermode_loop<span class=\"token operator\">+</span><span class=\"token number\">0x1c6</span><span class=\"token operator\">/</span><span class=\"token number\">0x230</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.943435</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> syscall_return_slowpath<span class=\"token operator\">+</span><span class=\"token number\">0x4e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4e0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.943889</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> syscall_return_slowpath<span class=\"token operator\">+</span><span class=\"token number\">0x342</span><span class=\"token operator\">/</span><span class=\"token number\">0x4e0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.944351</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_user<span class=\"token operator\">+</span><span class=\"token number\">0x18</span><span class=\"token operator\">/</span><span class=\"token number\">0x18</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.944721</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> async_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x2f</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.945180</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_off_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.945734</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> async_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x2f</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.946290</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> async_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x45</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.946824</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.947035</span><span class=\"token punctuation\">]</span> The buggy address belongs to the page<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.947726</span><span class=\"token punctuation\">]</span> page<span class=\"token operator\">:</span>ffffea00008bbf80 count<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapcount<span class=\"token operator\">:</span><span class=\"token number\">0</span> mapping<span class=\"token operator\">:</span><span class=\"token number\">0000000000000000</span> index<span class=\"token operator\">:</span><span class=\"token number\">0x0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.948791</span><span class=\"token punctuation\">]</span> flags<span class=\"token operator\">:</span> <span class=\"token number\">0x100000000000000</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.949241</span><span class=\"token punctuation\">]</span> raw<span class=\"token operator\">:</span> <span class=\"token number\">0100000000000000</span> <span class=\"token number\">0000000000000000</span> <span class=\"token number\">0000000000000000</span> <span class=\"token number\">00000000ffff</span>ffff\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.950342</span><span class=\"token punctuation\">]</span> raw<span class=\"token operator\">:</span> <span class=\"token number\">0000000000000000</span> dead000000000200 <span class=\"token number\">0000000000000000</span> <span class=\"token number\">0000000000000000</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.951364</span><span class=\"token punctuation\">]</span> page dumped because<span class=\"token operator\">:</span> kasan<span class=\"token operator\">:</span> bad access detected\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.952057</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.952367</span><span class=\"token punctuation\">]</span> Memory state around the buggy address<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.953002</span><span class=\"token punctuation\">]</span>  ffff880022efe980<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.953821</span><span class=\"token punctuation\">]</span>  ffff880022efea00<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.954860</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">></span>ffff880022efea80<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> ca ca ca ca <span class=\"token number\">02</span> cb cb cb cb cb cb cb\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.955823</span><span class=\"token punctuation\">]</span>                                                        <span class=\"token operator\">^</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.956398</span><span class=\"token punctuation\">]</span>  ffff880022efeb00<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.957172</span><span class=\"token punctuation\">]</span>  ffff880022efeb80<span class=\"token operator\">:</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> <span class=\"token number\">00</span> f1 f1 f1 f1 <span class=\"token number\">02</span> f2 f2 f2 f2 f2 f2 f2 <span class=\"token number\">00</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.958089</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.958800</span><span class=\"token punctuation\">]</span> Disabling lock debugging due to kernel taint\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.959376</span><span class=\"token punctuation\">]</span> Kernel panic <span class=\"token operator\">-</span> not syncing<span class=\"token operator\">:</span> panic_on_warn set <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.959376</span><span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.959999</span><span class=\"token punctuation\">]</span> CPU<span class=\"token operator\">:</span> <span class=\"token number\">0</span> PID<span class=\"token operator\">:</span> <span class=\"token number\">7812</span> Comm<span class=\"token operator\">:</span> syz<span class=\"token operator\">-</span>executor7 Tainted<span class=\"token operator\">:</span> G    B            <span class=\"token number\">4.16</span><span class=\"token number\">.0</span><span class=\"token operator\">-</span>rc4 #<span class=\"token number\">6</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.960804</span><span class=\"token punctuation\">]</span> Hardware name<span class=\"token operator\">:</span> QEMU Standard <span class=\"token function\">PC</span> <span class=\"token punctuation\">(</span>i440FX <span class=\"token operator\">+</span> PIIX<span class=\"token punctuation\">,</span> <span class=\"token number\">1996</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> BIOS <span class=\"token number\">1.10</span><span class=\"token number\">.2</span><span class=\"token operator\">-</span><span class=\"token number\">1u</span>buntu1 <span class=\"token number\">04</span><span class=\"token operator\">/</span><span class=\"token number\">01</span><span class=\"token operator\">/</span><span class=\"token number\">2014</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.961596</span><span class=\"token punctuation\">]</span> Call Trace<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.961811</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">&lt;</span>IRQ<span class=\"token operator\">></span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.962030</span><span class=\"token punctuation\">]</span>  dump_stack<span class=\"token operator\">+</span><span class=\"token number\">0x127</span><span class=\"token operator\">/</span><span class=\"token number\">0x213</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.962440</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _atomic_dec_and_lock<span class=\"token operator\">+</span><span class=\"token number\">0x18d</span><span class=\"token operator\">/</span><span class=\"token number\">0x18d</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.962954</span><span class=\"token punctuation\">]</span>  panic<span class=\"token operator\">+</span><span class=\"token number\">0x1f8</span><span class=\"token operator\">/</span><span class=\"token number\">0x46f</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.963226</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> add_taint<span class=\"token punctuation\">.</span>cold<span class=\"token punctuation\">.</span><span class=\"token number\">5</span><span class=\"token operator\">+</span><span class=\"token number\">0x16</span><span class=\"token operator\">/</span><span class=\"token number\">0x16</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.963553</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> add_taint<span class=\"token operator\">+</span><span class=\"token number\">0x21</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.963825</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_exclude_event<span class=\"token operator\">+</span><span class=\"token number\">0x17e</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.964222</span><span class=\"token punctuation\">]</span>  kasan_end_report<span class=\"token operator\">+</span><span class=\"token number\">0x43</span><span class=\"token operator\">/</span><span class=\"token number\">0x49</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.964525</span><span class=\"token punctuation\">]</span>  kasan_report<span class=\"token punctuation\">.</span>cold<span class=\"token punctuation\">.</span><span class=\"token number\">6</span><span class=\"token operator\">+</span><span class=\"token number\">0xc8</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f4</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.964911</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_exclude_event<span class=\"token operator\">+</span><span class=\"token number\">0x17e</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.965295</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_swevent_hrtimer<span class=\"token operator\">+</span><span class=\"token number\">0x28c</span><span class=\"token operator\">/</span><span class=\"token number\">0x500</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.965795</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.966188</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> scsi_finish_command<span class=\"token operator\">+</span><span class=\"token number\">0x611</span><span class=\"token operator\">/</span><span class=\"token number\">0x810</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.966716</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_iterate_ctx<span class=\"token operator\">+</span><span class=\"token number\">0x420</span><span class=\"token operator\">/</span><span class=\"token number\">0x420</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.967079</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.967399</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_nmi_exit<span class=\"token operator\">+</span><span class=\"token number\">0x742</span><span class=\"token operator\">/</span><span class=\"token number\">0x970</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.967797</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> find_held_lock<span class=\"token operator\">+</span><span class=\"token number\">0x33</span><span class=\"token operator\">/</span><span class=\"token number\">0x1b0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.968138</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.968501</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.968824</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x4a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.969160</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.969534</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> enqueue_hrtimer<span class=\"token operator\">+</span><span class=\"token number\">0x171</span><span class=\"token operator\">/</span><span class=\"token number\">0x500</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.969893</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_raw_spin_trylock<span class=\"token operator\">+</span><span class=\"token number\">0x190</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.970309</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.970656</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __lock_is_held<span class=\"token operator\">+</span><span class=\"token number\">0xad</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.970999</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __hrtimer_run_queues<span class=\"token operator\">+</span><span class=\"token number\">0x379</span><span class=\"token operator\">/</span><span class=\"token number\">0x1000</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.971508</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> perf_iterate_ctx<span class=\"token operator\">+</span><span class=\"token number\">0x420</span><span class=\"token operator\">/</span><span class=\"token number\">0x420</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.971873</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> hrtimer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0x10b</span><span class=\"token operator\">/</span><span class=\"token number\">0x730</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.972324</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> hrtimer_init<span class=\"token operator\">+</span><span class=\"token number\">0x430</span><span class=\"token operator\">/</span><span class=\"token number\">0x430</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.972663</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_downgrade<span class=\"token operator\">+</span><span class=\"token number\">0x6d0</span><span class=\"token operator\">/</span><span class=\"token number\">0x6d0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.973047</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_read_lock_sched_held<span class=\"token operator\">+</span><span class=\"token number\">0x102</span><span class=\"token operator\">/</span><span class=\"token number\">0x120</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.973472</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> pvclock_read_flags<span class=\"token operator\">+</span><span class=\"token number\">0x150</span><span class=\"token operator\">/</span><span class=\"token number\">0x150</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.973889</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __lock_is_held<span class=\"token operator\">+</span><span class=\"token number\">0xad</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.974284</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> kvm_clock_read<span class=\"token operator\">+</span><span class=\"token number\">0x21</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.974686</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ktime_get_update_offsets_now<span class=\"token operator\">+</span><span class=\"token number\">0x324</span><span class=\"token operator\">/</span><span class=\"token number\">0x400</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.975245</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_timer<span class=\"token operator\">+</span><span class=\"token number\">0x40</span><span class=\"token operator\">/</span><span class=\"token number\">0x40</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.975596</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.976009</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_read_lock_sched_held<span class=\"token operator\">+</span><span class=\"token number\">0x102</span><span class=\"token operator\">/</span><span class=\"token number\">0x120</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.976572</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> hpet_assign_irq<span class=\"token operator\">+</span><span class=\"token number\">0x1e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x1e0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.976989</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> hrtimer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0x2e9</span><span class=\"token operator\">/</span><span class=\"token number\">0x730</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.977367</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> smp_apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0x14d</span><span class=\"token operator\">/</span><span class=\"token number\">0x710</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.977947</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> smp_call_function_single_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0x660</span><span class=\"token operator\">/</span><span class=\"token number\">0x660</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.978485</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> handle_edge_irq<span class=\"token operator\">+</span><span class=\"token number\">0x322</span><span class=\"token operator\">/</span><span class=\"token number\">0x840</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.978808</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> task_prio<span class=\"token operator\">+</span><span class=\"token number\">0x50</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.979078</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _raw_spin_unlock<span class=\"token operator\">+</span><span class=\"token number\">0x1f</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.979487</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_off_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.979981</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> apic_timer_interrupt<span class=\"token operator\">+</span><span class=\"token number\">0xf</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.980424</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>IRQ<span class=\"token operator\">></span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.980611</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> crypto_shash_update<span class=\"token operator\">+</span><span class=\"token number\">0x23d</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.980950</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> kasan_disable_current<span class=\"token operator\">+</span><span class=\"token number\">0x20</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.981380</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> crypto_shash_update<span class=\"token operator\">+</span><span class=\"token number\">0x24d</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.981765</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_inode_csum<span class=\"token punctuation\">.</span>isra<span class=\"token punctuation\">.</span><span class=\"token number\">59</span><span class=\"token operator\">+</span><span class=\"token number\">0x562</span><span class=\"token operator\">/</span><span class=\"token number\">0xef0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.982281</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_journalled_zero_new_buffers<span class=\"token operator\">+</span><span class=\"token number\">0x4e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4e0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.982830</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_on_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.983316</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.983706</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.984134</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_on_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.984642</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.985038</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_inode_csum_set<span class=\"token operator\">+</span><span class=\"token number\">0x17c</span><span class=\"token operator\">/</span><span class=\"token number\">0x370</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.985499</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_mark_iloc_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x1709</span><span class=\"token operator\">/</span><span class=\"token number\">0x2cc0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.986034</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_chunk_trans_blocks<span class=\"token operator\">+</span><span class=\"token number\">0x20</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.986437</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_add_journal_head<span class=\"token operator\">+</span><span class=\"token number\">0x3b0</span><span class=\"token operator\">/</span><span class=\"token number\">0x560</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.987001</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_write_access_granted<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">8</span><span class=\"token operator\">+</span><span class=\"token number\">0x264</span><span class=\"token operator\">/</span><span class=\"token number\">0x410</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.987726</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_write_metadata_buffer<span class=\"token operator\">+</span><span class=\"token number\">0xf80</span><span class=\"token operator\">/</span><span class=\"token number\">0xf80</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.988386</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_note_context_switch<span class=\"token operator\">+</span><span class=\"token number\">0x710</span><span class=\"token operator\">/</span><span class=\"token number\">0x710</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.988941</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_put_journal_head<span class=\"token operator\">+</span><span class=\"token number\">0x3b1</span><span class=\"token operator\">/</span><span class=\"token number\">0x54f</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.989555</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> jbd2_journal_get_write_access<span class=\"token operator\">+</span><span class=\"token number\">0x6b</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.990150</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __ext4_journal_get_write_access<span class=\"token operator\">+</span><span class=\"token number\">0x143</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.990780</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_mark_inode_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x220</span><span class=\"token operator\">/</span><span class=\"token number\">0xac0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.991317</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_dirty_inode<span class=\"token operator\">+</span><span class=\"token number\">0x8d</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.991783</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_expand_extra_isize<span class=\"token operator\">+</span><span class=\"token number\">0x560</span><span class=\"token operator\">/</span><span class=\"token number\">0x560</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.992336</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __lock_is_held<span class=\"token operator\">+</span><span class=\"token number\">0xad</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.992794</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_setattr<span class=\"token operator\">+</span><span class=\"token number\">0x2a90</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a90</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.993266</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __ext4_journal_start_sb<span class=\"token operator\">+</span><span class=\"token number\">0x175</span><span class=\"token operator\">/</span><span class=\"token number\">0x5d0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.993818</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_dirty_inode<span class=\"token operator\">+</span><span class=\"token number\">0x5b</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.994288</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_journal_abort_handle<span class=\"token punctuation\">.</span>isra<span class=\"token punctuation\">.</span><span class=\"token number\">4</span><span class=\"token operator\">+</span><span class=\"token number\">0x250</span><span class=\"token operator\">/</span><span class=\"token number\">0x250</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.994930</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __lock_is_held<span class=\"token operator\">+</span><span class=\"token number\">0xad</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.995391</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_setattr<span class=\"token operator\">+</span><span class=\"token number\">0x2a90</span><span class=\"token operator\">/</span><span class=\"token number\">0x2a90</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.995860</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_dirty_inode<span class=\"token operator\">+</span><span class=\"token number\">0x8d</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.996326</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __mark_inode_dirty<span class=\"token operator\">+</span><span class=\"token number\">0x798</span><span class=\"token operator\">/</span><span class=\"token number\">0x1570</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.996841</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> redirty_tail<span class=\"token operator\">+</span><span class=\"token number\">0x200</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.997294</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> preempt_schedule_common<span class=\"token operator\">+</span><span class=\"token number\">0x1d</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.997851</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> _cond_resched<span class=\"token operator\">+</span><span class=\"token number\">0x18</span><span class=\"token operator\">/</span><span class=\"token number\">0x20</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.998289</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> filemap_fault<span class=\"token operator\">+</span><span class=\"token number\">0x5bf</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.998728</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.999165</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">45.999571</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_on_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.000071</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.000479</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> current_kernel_time64<span class=\"token operator\">+</span><span class=\"token number\">0x189</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.000977</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> current_kernel_time64<span class=\"token operator\">+</span><span class=\"token number\">0x1a4</span><span class=\"token operator\">/</span><span class=\"token number\">0x200</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.001484</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> generic_update_time<span class=\"token operator\">+</span><span class=\"token number\">0x26a</span><span class=\"token operator\">/</span><span class=\"token number\">0x430</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.001959</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> put_itimerspec64<span class=\"token operator\">+</span><span class=\"token number\">0x2f0</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.002414</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> dentry_needs_remove_privs<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">24</span><span class=\"token operator\">+</span><span class=\"token number\">0x60</span><span class=\"token operator\">/</span><span class=\"token number\">0x60</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.003026</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x1b3</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.003463</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> dentry_needs_remove_privs<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">.</span><span class=\"token number\">24</span><span class=\"token operator\">+</span><span class=\"token number\">0x60</span><span class=\"token operator\">/</span><span class=\"token number\">0x60</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.004050</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> file_update_time<span class=\"token operator\">+</span><span class=\"token number\">0x383</span><span class=\"token operator\">/</span><span class=\"token number\">0x620</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.004511</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> current_time<span class=\"token operator\">+</span><span class=\"token number\">0xc0</span><span class=\"token operator\">/</span><span class=\"token number\">0xc0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.004927</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_read_lock_sched_held<span class=\"token operator\">+</span><span class=\"token number\">0x102</span><span class=\"token operator\">/</span><span class=\"token number\">0x120</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.005492</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> rcu_sync_lockdep_assert<span class=\"token operator\">+</span><span class=\"token number\">0x6f</span><span class=\"token operator\">/</span><span class=\"token number\">0xb0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.006020</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __sb_start_write<span class=\"token operator\">+</span><span class=\"token number\">0x171</span><span class=\"token operator\">/</span><span class=\"token number\">0x2f0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.006505</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_page_mkwrite<span class=\"token operator\">+</span><span class=\"token number\">0x1db</span><span class=\"token operator\">/</span><span class=\"token number\">0x1320</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.007011</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> futex_wake<span class=\"token operator\">+</span><span class=\"token number\">0x6d0</span><span class=\"token operator\">/</span><span class=\"token number\">0x6d0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.007444</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_change_inode_journal_flag<span class=\"token operator\">+</span><span class=\"token number\">0x3f0</span><span class=\"token operator\">/</span><span class=\"token number\">0x3f0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.008083</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> ext4_filemap_fault<span class=\"token operator\">+</span><span class=\"token number\">0x75</span><span class=\"token operator\">/</span><span class=\"token number\">0xa4</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.008564</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __down_interruptible<span class=\"token operator\">+</span><span class=\"token number\">0x700</span><span class=\"token operator\">/</span><span class=\"token number\">0x700</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.009079</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_page_mkwrite<span class=\"token operator\">+</span><span class=\"token number\">0x137</span><span class=\"token operator\">/</span><span class=\"token number\">0x470</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.009532</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __do_fault<span class=\"token operator\">+</span><span class=\"token number\">0x3f0</span><span class=\"token operator\">/</span><span class=\"token number\">0x3f0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.009938</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> wake_up_page_bit<span class=\"token operator\">+</span><span class=\"token number\">0x610</span><span class=\"token operator\">/</span><span class=\"token number\">0x610</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.010420</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __handle_mm_fault<span class=\"token operator\">+</span><span class=\"token number\">0x448</span><span class=\"token operator\">/</span><span class=\"token number\">0x3940</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.010910</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __handle_mm_fault<span class=\"token operator\">+</span><span class=\"token number\">0x1e62</span><span class=\"token operator\">/</span><span class=\"token number\">0x3940</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.011389</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> vm_insert_mixed_mkwrite<span class=\"token operator\">+</span><span class=\"token number\">0x30</span><span class=\"token operator\">/</span><span class=\"token number\">0x30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.011915</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.012341</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> find_held_lock<span class=\"token operator\">+</span><span class=\"token number\">0x33</span><span class=\"token operator\">/</span><span class=\"token number\">0x1b0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.012772</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> print_usage_bug<span class=\"token operator\">+</span><span class=\"token number\">0x140</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.013216</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> exit_robust_list<span class=\"token operator\">+</span><span class=\"token number\">0x290</span><span class=\"token operator\">/</span><span class=\"token number\">0x290</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.013701</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> print_usage_bug<span class=\"token operator\">+</span><span class=\"token number\">0x140</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.014177</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> print_usage_bug<span class=\"token operator\">+</span><span class=\"token number\">0x140</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.014634</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x4a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.015048</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> lock_acquire<span class=\"token operator\">+</span><span class=\"token number\">0x4a0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4a0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.015463</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> print_usage_bug<span class=\"token operator\">+</span><span class=\"token number\">0x140</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.015904</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_raw_spin_trylock<span class=\"token operator\">+</span><span class=\"token number\">0x190</span><span class=\"token operator\">/</span><span class=\"token number\">0x190</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.016383</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.016784</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.017230</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> find_held_lock<span class=\"token operator\">+</span><span class=\"token number\">0x33</span><span class=\"token operator\">/</span><span class=\"token number\">0x1b0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.017678</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.018163</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.018618</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.019038</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> save_trace<span class=\"token operator\">+</span><span class=\"token number\">0x300</span><span class=\"token operator\">/</span><span class=\"token number\">0x300</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.019464</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mark_held_locks<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x140</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.019913</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.020311</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_on_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.020782</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_kernel<span class=\"token operator\">+</span><span class=\"token number\">0x10</span><span class=\"token operator\">/</span><span class=\"token number\">0x10</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.021192</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> handle_mm_fault<span class=\"token operator\">+</span><span class=\"token number\">0x15a</span><span class=\"token operator\">/</span><span class=\"token number\">0x410</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.021711</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __do_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x672</span><span class=\"token operator\">/</span><span class=\"token number\">0xe30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.022230</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> mm_fault_error<span class=\"token operator\">+</span><span class=\"token number\">0x360</span><span class=\"token operator\">/</span><span class=\"token number\">0x360</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.022738</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> SyS_clock_settime<span class=\"token operator\">+</span><span class=\"token number\">0x230</span><span class=\"token operator\">/</span><span class=\"token number\">0x230</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.023278</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> async_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x2f</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.023782</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> do_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0xc1</span><span class=\"token operator\">/</span><span class=\"token number\">0x720</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.024267</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> __do_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0xe30</span><span class=\"token operator\">/</span><span class=\"token number\">0xe30</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.024782</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> exit_to_usermode_loop<span class=\"token operator\">+</span><span class=\"token number\">0x1c6</span><span class=\"token operator\">/</span><span class=\"token number\">0x230</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.025326</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> syscall_return_slowpath<span class=\"token operator\">+</span><span class=\"token number\">0x4e0</span><span class=\"token operator\">/</span><span class=\"token number\">0x4e0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.025880</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> syscall_return_slowpath<span class=\"token operator\">+</span><span class=\"token number\">0x342</span><span class=\"token operator\">/</span><span class=\"token number\">0x4e0</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.026432</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> retint_user<span class=\"token operator\">+</span><span class=\"token number\">0x18</span><span class=\"token operator\">/</span><span class=\"token number\">0x18</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.026854</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> async_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x2f</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.027320</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> trace_hardirqs_off_thunk<span class=\"token operator\">+</span><span class=\"token number\">0x1a</span><span class=\"token operator\">/</span><span class=\"token number\">0x1c</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.027912</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> async_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x2f</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.028432</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">?</span> async_page_fault<span class=\"token operator\">+</span><span class=\"token number\">0x45</span><span class=\"token operator\">/</span><span class=\"token number\">0x50</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.029012</span><span class=\"token punctuation\">]</span> Dumping ftrace buffer<span class=\"token operator\">:</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.029472</span><span class=\"token punctuation\">]</span>    <span class=\"token punctuation\">(</span>ftrace buffer empty<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.029930</span><span class=\"token punctuation\">]</span> Kernel Offset<span class=\"token operator\">:</span> <span class=\"token number\">0x25a00000</span> from <span class=\"token number\">0xffffffff81000000</span> <span class=\"token punctuation\">(</span>relocation range<span class=\"token operator\">:</span> <span class=\"token number\">0xffffffff80000000</span><span class=\"token operator\">-</span><span class=\"token number\">0xffffffffbfffffff</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span>   <span class=\"token number\">46.031275</span><span class=\"token punctuation\">]</span> Rebooting in <span class=\"token number\">86400</span> seconds<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><strong>End</strong></p>","excerpt":"handle_irq - OOBs Call Trace (Dump) PoC funny, just one call, . do_irq - alloca Out Of Bounds Call Trace (Dump) PoC generated by syz-repro.…","tableOfContents":"<ul>\n<li>\n<p><a href=\"#handle_irq---oobs\">handle_irq - OOBs</a></p>\n<ul>\n<li><a href=\"#call-trace-dump\">Call Trace (Dump)</a></li>\n<li><a href=\"#poc\">PoC</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#do_irq---alloca-out-of-bounds\">do_irq - alloca Out Of Bounds</a></p>\n<ul>\n<li><a href=\"#call-trace-dump-1\">Call Trace (Dump)</a></li>\n<li><a href=\"#poc-1\">PoC</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#unwind_next_frame---alloca-out-of-bounds\">unwind_next_frame - alloca Out Of Bounds</a></p>\n<ul>\n<li><a href=\"#call-trace-dump-2\">Call Trace (Dump)</a></li>\n<li><a href=\"#poc-2\">PoC</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#default_idle---soft-lockup\">default_idle - soft lockup</a></p>\n<ul>\n<li><a href=\"#call-trace-dump-3\">Call Trace (Dump)</a></li>\n<li><a href=\"#source-code\">Source Code</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#perf_exclude_event---alloca-out-of-bounds\">perf_exclude_event - alloca Out Of Bounds</a></p>\n<ul>\n<li><a href=\"#call-trace-dump-4\">Call Trace (Dump)</a></li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/2018-03-1-Founds/"},"frontmatter":{"title":"Linux Kernel - 2018-03-1 Founds","date":"Mar 01, 2018","tags":["Security","Linux-Kernel"],"keywords":["0-day","Bug"],"update":"Mar 06, 2018"},"timeToRead":76}},"pageContext":{"slug":"/2018-03-1-Founds/","series":[],"lastmod":"2018-03-06"}},"staticQueryHashes":["2027115977","2744905544","694178885"],"slicesMap":{}}